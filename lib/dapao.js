!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o=e();for(var i in o)("object"==typeof exports?exports:t)[i]=o[i]}}("undefined"!=typeof self?self:this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=27)}([function(t,e,o){"use strict";o.d(e,"a",function(){return n}),o.d(e,"b",function(){return r});var i=o(5),n=function(){function t(t,e,o){this.x=t||0,this.y=e||0,this.z=o||0}return t.prototype.cross=function(e,o){var i=e.x,n=e.y,r=e.z,s=this.x,a=this.y,u=this.z;return o=o||new t,o.x=a*r-u*n,o.y=u*i-s*r,o.z=s*n-a*i,o},t.prototype.set=function(t,e,o){return this.x=t,this.y=e,this.z=o,this},t.prototype.setZero=function(){this.x=this.y=this.z=0},t.prototype.vadd=function(e,o){return o?(o.x=e.x+this.x,o.y=e.y+this.y,o.z=e.z+this.z,o):new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.vsub=function(e,o){return o?(o.x=this.x-e.x,o.y=this.y-e.y,o.z=this.z-e.z,o):new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.crossmat=function(){return new i.a([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},t.prototype.normalize=function(){var t=this.x,e=this.y,o=this.z,i=Math.sqrt(t*t+e*e+o*o);if(i>0){var n=1/i;this.x*=n,this.y*=n,this.z*=n}else this.x=0,this.y=0,this.z=0;return i},t.prototype.unit=function(e){e=e||new t;var o=this.x,i=this.y,n=this.z,r=Math.sqrt(o*o+i*i+n*n);return r>0?(r=1/r,e.x=o*r,e.y=i*r,e.z=n*r):(e.x=1,e.y=0,e.z=0),e},t.prototype.norm=function(){var t=this.x,e=this.y,o=this.z;return Math.sqrt(t*t+e*e+o*o)},t.prototype.length=function(){return this.norm()},t.prototype.norm2=function(){return this.dot(this)},t.prototype.distanceTo=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,r=t.y,s=t.z;return Math.sqrt((n-e)*(n-e)+(r-o)*(r-o)+(s-i)*(s-i))},t.prototype.distanceSquared=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,r=t.y,s=t.z;return(n-e)*(n-e)+(r-o)*(r-o)+(s-i)*(s-i)},t.prototype.mult=function(e,o){o=o||new t;var i=this.x,n=this.y,r=this.z;return o.x=e*i,o.y=e*n,o.z=e*r,o},t.prototype.vmul=function(e,o){return o=o||new t,o.x=e.x*this.x,o.y=e.y*this.y,o.z=e.z*this.z,o},t.prototype.scale=function(t,e){return this.mult(t,e)},t.prototype.addScaledVector=function(e,o,i){return i=i||new t,i.x=this.x+e*o.x,i.y=this.y+e*o.y,i.z=this.z+e*o.z,i},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},t.prototype.negate=function(e){return e=e||new t,e.x=-this.x,e.y=-this.y,e.z=-this.z,e},t.prototype.tangents=function(e,o){var i=new t,n=new t,r=this.norm();if(r>0){var s=i,a=1/r;s.set(this.x*a,this.y*a,this.z*a);var u=n;Math.abs(s.x)<.9?(u.set(1,0,0),s.cross(u,e)):(u.set(0,1,0),s.cross(u,e)),s.cross(e,o)}else e.set(1,0,0),o.set(0,1,0)},t.prototype.toString=function(){return this.x+","+this.y+","+this.z},t.prototype.toArray=function(){return[this.x,this.y,this.z]},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.lerp=function(t,e,o){var i=this.x,n=this.y,r=this.z;o.x=i+(t.x-i)*e,o.y=n+(t.y-n)*e,o.z=r+(t.z-r)*e},t.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},t.prototype.almostZero=function(t){return void 0===t&&(t=0),void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)},t.prototype.isAntiparallelTo=function(e,o){void 0===o&&(o=0);var i=new t;return this.negate(i),i.almostEquals(e,o)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t}(),r=function(){function t(){}return t.ZERO=new n(0,0,0),t.UNIT_X=new n(1,0,0),t.UNIT_Y=new n(0,1,0),t.UNIT_Z=new n(0,0,1),t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(e){e=e||{},this.id=t.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}return t.prototype.updateBoundingSphereRadius=function(){throw new Error("computeBoundingSphereRadius() not implemented for shape type "+this.type)},t.prototype.volume=function(){throw new Error("volume() not implemented for shape type "+this.type)},t.prototype.calculateLocalInertia=function(t,e){throw new Error("calculateLocalInertia() not implemented for shape type "+this.type)},t.prototype.calculateWorldAABB=function(t,e,o,i){throw new Error("calculateLocalInertia() not implemented for shape type "+this.type)},t.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(0),n=function(){function t(t,e,o,n){this.sfv_t1=new i.a,this.sfv_t2=new i.a,this.Quaternion_mult_va=new i.a,this.Quaternion_mult_vb=new i.a,this.Quaternion_mult_vaxvb=new i.a,this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==o?o:0,this.w=void 0!==n?n:1}return t.prototype.set=function(t,e,o,i){return this.x=t,this.y=e,this.z=o,this.w=i,this},t.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},t.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.setFromAxisAngle=function(t,e){var o=Math.sin(.5*e);return this.x=t.x*o,this.y=t.y*o,this.z=t.z*o,this.w=Math.cos(.5*e),this},t.prototype.toAxisAngle=function(t){t=t||new i.a,this.normalize();var e=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/o,t.y=this.y/o,t.z=this.z/o),[t,e]},t.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var o=this.sfv_t1,i=this.sfv_t2;t.tangents(o,i),this.setFromAxisAngle(o,Math.PI)}else{var n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}return this},t.prototype.mult=function(e,o){o=o||new t;var i=this.x,n=this.y,r=this.z,s=this.w,a=e.x,u=e.y,h=e.z,l=e.w;return o.x=i*l+s*a+n*h-r*u,o.y=n*l+s*u+r*a-i*h,o.z=r*l+s*h+i*u-n*a,o.w=s*l-i*a-n*u-r*h,o},t.prototype.inverse=function(e){var o=this.x,i=this.y,n=this.z,r=this.w;e=e||new t,this.conjugate(e);var s=1/(o*o+i*i+n*n+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e},t.prototype.conjugate=function(e){return e=e||new t,e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},t.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},t.prototype.vmult=function(t,e){e=e||new i.a;var o=t.x,n=t.y,r=t.z,s=this.x,a=this.y,u=this.z,h=this.w,l=h*o+a*r-u*n,p=h*n+u*o-s*r,c=h*r+s*n-a*o,d=-s*o-a*n-u*r;return e.x=l*h+d*-s+p*-u-c*-a,e.y=p*h+d*-a+c*-s-l*-u,e.z=c*h+d*-u+l*-a-p*-s,e},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.toEuler=function(t,e){e=e||"YZX";var o,i,n,r=this.x,s=this.y,a=this.z,u=this.w;switch(e){case"YZX":var h=r*s+a*u;if(h>.499&&(o=2*Math.atan2(r,u),i=Math.PI/2,n=0),h<-.499&&(o=-2*Math.atan2(r,u),i=-Math.PI/2,n=0),isNaN(o)){var l=r*r,p=s*s,c=a*a;o=Math.atan2(2*s*u-2*r*a,1-2*p-2*c),i=Math.asin(2*h),n=Math.atan2(2*r*u-2*s*a,1-2*l-2*c)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=o,t.z=i,t.x=n},t.prototype.setFromEuler=function(t,e,o,i){void 0===i&&(i="XYZ");var n=Math.cos(t/2),r=Math.cos(e/2),s=Math.cos(o/2),a=Math.sin(t/2),u=Math.sin(e/2),h=Math.sin(o/2);return"XYZ"===i?(this.x=a*r*s+n*u*h,this.y=n*u*s-a*r*h,this.z=n*r*h+a*u*s,this.w=n*r*s-a*u*h):"YXZ"===i?(this.x=a*r*s+n*u*h,this.y=n*u*s-a*r*h,this.z=n*r*h-a*u*s,this.w=n*r*s+a*u*h):"ZXY"===i?(this.x=a*r*s-n*u*h,this.y=n*u*s+a*r*h,this.z=n*r*h+a*u*s,this.w=n*r*s-a*u*h):"ZYX"===i?(this.x=a*r*s-n*u*h,this.y=n*u*s+a*r*h,this.z=n*r*h-a*u*s,this.w=n*r*s+a*u*h):"YZX"===i?(this.x=a*r*s+n*u*h,this.y=n*u*s+a*r*h,this.z=n*r*h-a*u*s,this.w=n*r*s-a*u*h):"XZY"===i&&(this.x=a*r*s-n*u*h,this.y=n*u*s-a*r*h,this.z=n*r*h+a*u*s,this.w=n*r*s+a*u*h),this},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.slerp=function(e,o,i){i=i||new t;var n,r,s,a,u,h=this.x,l=this.y,p=this.z,c=this.w,d=e.x,v=e.y,f=e.z,y=e.w;return r=h*d+l*v+p*f+c*y,r<0&&(r=-r,d=-d,v=-v,f=-f,y=-y),1-r>1e-6?(n=Math.acos(r),s=Math.sin(n),a=Math.sin((1-o)*n)/s,u=Math.sin(o*n)/s):(a=1-o,u=o),i.x=a*h+u*d,i.y=a*l+u*v,i.z=a*p+u*f,i.w=a*c+u*y,i},t.prototype.integrate=function(e,o,i,n){n=n||new t;var r=e.x*i.x,s=e.y*i.y,a=e.z*i.z,u=this.x,h=this.y,l=this.z,p=this.w,c=.5*o;return n.x+=c*(r*p+s*l-a*h),n.y+=c*(s*p+a*u-r*l),n.z+=c*(a*p+r*h-s*u),n.w+=c*(-r*u-s*h-a*l),n},t}()},function(t,e,o){"use strict";o.d(e,"b",function(){return l}),o.d(e,"a",function(){return p});var i=o(6),n=o(0),r=o(2),s=o(5),a=o(4),u=o(12),h=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),l=function(){function t(){}return t}(),p=function(t){function e(o){var i=t.call(this)||this;i.tmpVec=new n.a,i.tmpQuat=new r.a,i.computeAABB_shapeAABB=new a.a,i.uiw_m1=new s.a,i.uiw_m2=new s.a,i.uiw_m3=new s.a,i.Body_applyForce_r=new n.a,i.Body_applyForce_rotForce=new n.a,i.Body_applyLocalForce_worldForce=new n.a,i.Body_applyLocalForce_relativePointWorld=new n.a,i.Body_applyImpulse_r=new n.a,i.Body_applyImpulse_velo=new n.a,i.Body_applyImpulse_rotVelo=new n.a,i.Body_applyLocalImpulse_worldImpulse=new n.a,i.Body_applyLocalImpulse_relativePoint=new n.a,i.Body_updateMassProperties_halfExtents=new n.a,i.invI_tau_dt=new n.a,i.w=new r.a,i.wq=new r.a,o=o||{},i.goid="",i.id=e.idCounter++,i.world=null,i.preStep=null,i.postStep=null,i.vlambda=new n.a,i.collisionFilterGroup="number"==typeof o.collisionFilterGroup?o.collisionFilterGroup:1,i.collisionFilterMask="number"==typeof o.collisionFilterMask?o.collisionFilterMask:-1,i.collisionResponse=!0,i.position=new n.a,i.previousPosition=new n.a,i.interpolatedPosition=new n.a,i.initPosition=new n.a,o.position&&(i.position.copy(o.position),i.previousPosition.copy(o.position),i.interpolatedPosition.copy(o.position),i.initPosition.copy(o.position)),i.velocity=new n.a,o.velocity&&i.velocity.copy(o.velocity),i.initVelocity=new n.a,i.force=new n.a;var u="number"==typeof o.mass?o.mass:0;return i.mass=u,i.invMass=u>0?1/u:0,i.material=o.material||null,i.linearDamping="number"==typeof o.linearDamping?o.linearDamping:.01,i.type=u<=0?e.STATIC:e.DYNAMIC,typeof o.type==typeof e.STATIC&&(i.type=o.type),i.allowSleep=void 0===o.allowSleep||o.allowSleep,i.sleepState=0,i.sleepSpeedLimit=void 0!==o.sleepSpeedLimit?o.sleepSpeedLimit:.1,i.sleepTimeLimit=void 0!==o.sleepTimeLimit?o.sleepTimeLimit:1,i.timeLastSleepy=0,i._wakeUpAfterNarrowphase=!1,i.torque=new n.a,i.quaternion=new r.a,i.initQuaternion=new r.a,i.previousQuaternion=new r.a,i.interpolatedQuaternion=new r.a,o.quaternion&&(i.quaternion.copy(o.quaternion),i.initQuaternion.copy(o.quaternion),i.previousQuaternion.copy(o.quaternion),i.interpolatedQuaternion.copy(o.quaternion)),i.angularVelocity=new n.a,o.angularVelocity&&i.angularVelocity.copy(o.angularVelocity),i.initAngularVelocity=new n.a,i.shapes=[],i.shapeOffsets=[],i.shapeOrientations=[],i.inertia=new n.a,i.invInertia=new n.a,i.invInertiaWorld=new s.a,i.invMassSolve=0,i.invInertiaSolve=new n.a,i.invInertiaWorldSolve=new s.a,i.fixedRotation=void 0!==o.fixedRotation&&o.fixedRotation,i.angularDamping=void 0!==o.angularDamping?o.angularDamping:.01,i.linearFactor=new n.a(1,1,1),o.linearFactor&&i.linearFactor.copy(o.linearFactor),i.angularFactor=new n.a(1,1,1),o.angularFactor&&i.angularFactor.copy(o.angularFactor),i.aabb=new a.a,i.aabbNeedsUpdate=!0,i.boundingRadius=0,i.wlambda=new n.a,o.shape&&i.addShape(o.shape),i.updateMassProperties(),i}return h(e,t),e.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,this._wakeUpAfterNarrowphase=!1,t===e.SLEEPING&&this.dispatchEvent(e.wakeupEvent)},e.prototype.sleep=function(){this.sleepState=e.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this._wakeUpAfterNarrowphase=!1},e.prototype.sleepTick=function(t){if(this.allowSleep){var o=this.sleepState,i=this.velocity.norm2()+this.angularVelocity.norm2(),n=Math.pow(this.sleepSpeedLimit,2);o===e.AWAKE&&i<n?(this.sleepState=e.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(e.sleepyEvent)):o===e.SLEEPY&&i>n?this.wakeUp():o===e.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(e.sleepEvent))}},e.prototype.updateSolveMassProperties=function(){this.sleepState===e.SLEEPING||this.type===e.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},e.prototype.pointToLocalFrame=function(t,e){return e=e||new n.a,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},e.prototype.vectorToLocalFrame=function(t,e){return e=e||new n.a,this.quaternion.conjugate().vmult(t,e),e},e.prototype.pointToWorldFrame=function(t,e){return e=e||new n.a,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},e.prototype.vectorToWorldFrame=function(t,e){return e=e||new n.a,this.quaternion.vmult(t,e),e},e.prototype.addShape=function(t,e,o){var i=new n.a,s=new r.a;return e&&i.copy(e),o&&s.copy(o),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this},e.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,o=t.length,i=0,n=0;n!==o;n++){var r=t[n];r.updateBoundingSphereRadius();var s=e[n].norm(),a=r.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i},e.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,o=this.shapeOrientations,i=t.length,n=this.tmpVec,r=this.tmpQuat,s=this.quaternion,a=this.aabb,u=this.computeAABB_shapeAABB,h=0;h!==i;h++){var l=t[h];s.vmult(e[h],n),n.vadd(this.position,n),o[h].mult(s,r),l.calculateWorldAABB(n,r,u.lowerBound,u.upperBound),0===h?a.copy(u):a.extend(u)}this.aabbNeedsUpdate=!1},e.prototype.updateInertiaWorld=function(t){void 0===t&&(t=!1);var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var o=this.uiw_m1,i=this.uiw_m2;this.uiw_m3,o.setRotationFromQuaternion(this.quaternion),o.transpose(i),o.scale(e,o),o.mmult(i,this.invInertiaWorld)}},e.prototype.applyForce=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyForce_rotForce;o.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}},e.prototype.applyLocalForce=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyLocalForce_worldForce,n=this.Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(o,n),this.applyForce(i,n)}},e.prototype.applyImpulse=function(t,o){if(this.type===e.DYNAMIC){var i=o,n=this.Body_applyImpulse_velo;n.copy(t),n.mult(this.invMass,n),this.velocity.vadd(n,this.velocity);var r=this.Body_applyImpulse_rotVelo;i.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}},e.prototype.applyLocalImpulse=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyLocalImpulse_worldImpulse,n=this.Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(o,n),this.applyImpulse(i,n)}},e.prototype.updateMassProperties=function(){var t=this.Body_updateMassProperties_halfExtents;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,o=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),u.a.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!o?1/e.x:0,e.y>0&&!o?1/e.y:0,e.z>0&&!o?1/e.z:0),this.updateInertiaWorld(!0)},e.prototype.getVelocityAtWorldPoint=function(t,e){var o=new n.a;return t.vsub(this.position,o),this.angularVelocity.cross(o,e),this.velocity.vadd(e,e),e},e.prototype.integrate=function(t,o,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===e.DYNAMIC||this.type===e.KINEMATIC)&&this.sleepState!==e.SLEEPING){var n=this.velocity,r=this.angularVelocity,s=this.position,a=this.force,u=this.torque,h=this.quaternion,l=this.invMass,p=this.invInertiaWorld,c=this.linearFactor,d=l*t;n.x+=a.x*d*c.x,n.y+=a.y*d*c.y,n.z+=a.z*d*c.z;var v=p.elements,f=this.angularFactor,y=u.x*f.x,m=u.y*f.y,w=u.z*f.z;r.x+=t*(v[0]*y+v[1]*m+v[2]*w),r.y+=t*(v[3]*y+v[4]*m+v[5]*w),r.z+=t*(v[6]*y+v[7]*m+v[8]*w),s.x+=n.x*t,s.y+=n.y*t,s.z+=n.z*t,h.integrate(this.angularVelocity,t,this.angularFactor,h),o&&(i?h.normalizeFast():h.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}},e.idCounter=0,e.COLLIDE_EVENT_NAME="collide",e.DYNAMIC=1,e.STATIC=2,e.KINEMATIC=4,e.AWAKE=0,e.SLEEPY=1,e.SLEEPING=2,e.wakeupEvent={type:"wakeup"},e.sleepyEvent={type:"sleepy"},e.sleepEvent={type:"sleep"},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(0),n=function(){function t(t){this.tmp=new i.a,this.transformIntoFrame_corners=[new i.a,new i.a,new i.a,new i.a,new i.a,new i.a,new i.a,new i.a],t=t||{},this.lowerBound=new i.a,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i.a,t.upperBound&&this.upperBound.copy(t.upperBound)}return t.prototype.setFromPoints=function(t,e,o,i){var n=this.lowerBound,r=this.upperBound,s=o;n.copy(t[0]),s&&s.vmult(n,n),r.copy(n);for(var a=1;a<t.length;a++){var u=t[a];s&&(s.vmult(u,this.tmp),u=this.tmp),u.x>r.x&&(r.x=u.x),u.x<n.x&&(n.x=u.x),u.y>r.y&&(r.y=u.y),u.y<n.y&&(n.y=u.y),u.z>r.z&&(r.z=u.z),u.z<n.z&&(n.z=u.z)}return e&&(e.vadd(n,n),e.vadd(r,r)),i&&(n.x-=i,n.y-=i,n.z-=i,r.x+=i,r.y+=i,r.z+=i),this},t.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.extend=function(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)},t.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound,r=i.x<=o.x&&o.x<=n.x||e.x<=n.x&&n.x<=o.x,s=i.y<=o.y&&o.y<=n.y||e.y<=n.y&&n.y<=o.y,a=i.z<=o.z&&o.z<=n.z||e.z<=n.z&&n.z<=o.z;return r&&s&&a},t.prototype.volume=function(){var t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)},t.prototype.contains=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return e.x<=i.x&&o.x>=n.x&&e.y<=i.y&&o.y>=n.y&&e.z<=i.z&&o.z>=n.z},t.prototype.getCorners=function(t,e,o,i,n,r,s,a){var u=this.lowerBound,h=this.upperBound;t.copy(u),e.set(h.x,u.y,u.z),o.set(h.x,h.y,u.z),i.set(u.x,h.y,h.z),n.set(h.x,u.y,u.z),r.set(u.x,h.y,u.z),s.set(u.x,u.y,h.z),a.copy(h)},t.prototype.toLocalFrame=function(t,e){var o=this.transformIntoFrame_corners,i=o[0],n=o[1],r=o[2],s=o[3],a=o[4],u=o[5],h=o[6],l=o[7];this.getCorners(i,n,r,s,a,u,h,l);for(var p=0;8!==p;p++){var c=o[p];t.pointToLocal(c,c)}return e.setFromPoints(o)},t.prototype.toWorldFrame=function(t,e){var o=this.transformIntoFrame_corners,i=o[0],n=o[1],r=o[2],s=o[3],a=o[4],u=o[5],h=o[6],l=o[7];this.getCorners(i,n,r,s,a,u,h,l);for(var p=0;8!==p;p++){var c=o[p];t.pointToWorld(c,c)}return e.setFromPoints(o)},t.prototype.overlapsRay=function(t){var e=1/t._direction.x,o=1/t._direction.y,i=1/t._direction.z,n=(this.lowerBound.x-t.from.x)*e,r=(this.upperBound.x-t.from.x)*e,s=(this.lowerBound.y-t.from.y)*o,a=(this.upperBound.y-t.from.y)*o,u=(this.lowerBound.z-t.from.z)*i,h=(this.upperBound.z-t.from.z)*i,l=Math.max(Math.max(Math.min(n,r),Math.min(s,a)),Math.min(u,h)),p=Math.min(Math.min(Math.max(n,r),Math.max(s,a)),Math.max(u,h));return!(p<0||l>p)},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(0),n=function(){function t(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}return t.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},t.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},t.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},t.prototype.getTrace=function(t){t=t||new i.a;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},t.prototype.vmult=function(t,e){e=e||new i.a;var o=this.elements,n=t.x,r=t.y,s=t.z;return e.x=o[0]*n+o[1]*r+o[2]*s,e.y=o[3]*n+o[4]*r+o[5]*s,e.z=o[6]*n+o[7]*r+o[8]*s,e},t.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},t.prototype.mmult=function(e,o){for(var i=o||new t,n=0;n<3;n++)for(var r=0;r<3;r++){for(var s=0,a=0;a<3;a++)s+=e.elements[n+3*a]*this.elements[a+3*r];i.elements[n+3*r]=s}return i},t.prototype.scale=function(e,o){o=o||new t;for(var i=this.elements,n=o.elements,r=0;3!==r;r++)n[3*r+0]=e.x*i[3*r+0],n[3*r+1]=e.y*i[3*r+1],n[3*r+2]=e.z*i[3*r+2];return o},t.prototype.solve=function(t,e){e=e||new i.a;for(var o=[],n=0;n<12;n++)o.push(0);for(var r,n=0;n<3;n++)for(r=0;r<3;r++)o[n+4*r]=this.elements[n+3*r];o[3]=t.x,o[7]=t.y,o[11]=t.z;var s,a,u=3,h=u;do{var n=h-u;if(0===o[n+4*n])for(r=n+1;r<h;r++)if(0!==o[n+4*r]){s=4;do{a=4-s,o[a+4*n]+=o[a+4*r]}while(--s);break}if(0!==o[n+4*n])for(r=n+1;r<h;r++){var l=o[n+4*r]/o[n+4*n];s=4;do{a=4-s,o[a+4*r]=a<=n?0:o[a+4*r]-o[a+4*n]*l}while(--s)}}while(--u);if(e.z=o[11]/o[10],e.y=(o[7]-o[6]*e.z)/o[5],e.x=(o[3]-o[2]*e.z-o[1]*e.y)/o[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw new Error("Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]");return e},t.prototype.e=function(t,e,o){return void 0===o?this.elements[e+3*t]:this.elements[e+3*t]=o},t.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},t.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},t.prototype.reverse=function(e){e=e||new t;var o=[],i=0;for(i=0;i<18;i++)o.push(0);var n;for(i=0;i<3;i++)for(n=0;n<3;n++)o[i+6*n]=this.elements[i+3*n];o[3]=1,o[9]=0,o[15]=0,o[4]=0,o[10]=1,o[16]=0,o[5]=0,o[11]=0,o[17]=1;var r,s,a=3,u=a;do{if(i=u-a,0===o[i+6*i])for(n=i+1;n<u;n++)if(0!==o[i+6*n]){r=6;do{s=6-r,o[s+6*i]+=o[s+6*n]}while(--r);break}if(0!==o[i+6*i])for(n=i+1;n<u;n++){var h=o[i+6*n]/o[i+6*i];r=6;do{s=6-r,o[s+6*n]=s<=i?0:o[s+6*n]-o[s+6*i]*h}while(--r)}}while(--a);i=2;do{n=i-1;do{var h=o[i+6*n]/o[i+6*i];r=6;do{s=6-r,o[s+6*n]=o[s+6*n]-o[s+6*i]*h}while(--r)}while(n--)}while(--i);i=2;do{var h=1/o[i+6*i];r=6;do{s=6-r,o[s+6*i]=o[s+6*i]*h}while(--r)}while(i--);i=2;do{n=2;do{if(s=o[3+n+6*i],isNaN(s)||s===1/0)throw new Error("Could not reverse! A=["+this.toString()+"]");e.e(i,n,s)}while(n--)}while(i--);return e},t.prototype.setRotationFromQuaternion=function(t){var e=t.x,o=t.y,i=t.z,n=t.w,r=e+e,s=o+o,a=i+i,u=e*r,h=e*s,l=e*a,p=o*s,c=o*a,d=i*a,v=n*r,f=n*s,y=n*a,m=this.elements;return m[0]=1-(p+d),m[1]=h-y,m[2]=l+f,m[3]=h+y,m[4]=1-(u+d),m[5]=c-v,m[6]=l-f,m[7]=c+v,m[8]=1-(u+p),this},t.prototype.transpose=function(e){e=e||new t;for(var o=e.elements,i=this.elements,n=0;3!==n;n++)for(var r=0;3!==r;r++)o[3*n+r]=i[3*r+n];return e},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){}return t.prototype.addEventListener=function(t,e){void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},t.prototype.hasEventListener=function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;return void 0!==o[t]&&-1!==o[t].indexOf(e)},t.prototype.hasAnyEventListener=function(t){return void 0!==this._listeners&&void 0!==this._listeners[t]},t.prototype.removeEventListener=function(t,e){if(void 0===this._listeners)return this;var o=this._listeners;if(void 0===o[t])return this;var i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},t.prototype.dispatchEvent=function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var i=0,n=o.length;i<n;i++)o[i].call(this,t)}return this},t}()},function(t,e,o){"use strict";o.d(e,"b",function(){return a}),o.d(e,"a",function(){return u});var i=o(1),n=o(0),r=o(13),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),a=function(){function t(){}return t}(),u=function(t){function e(e,o,r,s){var a=t.call(this,{type:i.a.types.CONVEXPOLYHEDRON})||this;return a.cli_aabbmin=new n.a,a.cli_aabbmax=new n.a,a.vertices=e||[],a.worldVertices=[],a.worldVerticesNeedsUpdate=!0,a.faces=o||[],a.faceNormals=s||[],a.computeNormals(),a.worldFaceNormalsNeedsUpdate=!0,a.worldFaceNormals=[],a.uniqueEdges=[],a.uniqueAxes=r?r.slice():null,a.computeEdges(),a.updateBoundingSphereRadius(),a}return s(e,t),e.prototype.computeEdges=function(){var t=new n.a,e=this.faces,o=this.vertices,i=(o.length,this.uniqueEdges);i.length=0;for(var r=t,s=0;s!==e.length;s++)for(var a=e[s],u=a.length,h=0;h!==u;h++){var l=(h+1)%u;o[a[h]].vsub(o[a[l]],r),r.normalize();for(var p=!1,c=0;c!==i.length;c++)if(i[c].almostEquals(r)||i[c].almostEquals(r)){p=!0;break}p||i.push(r.clone())}},e.prototype.computeNormals=function(){if(!this.faceNormals.length){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var o=this.faceNormals[t]||new n.a;this.getFaceNormal(t,o),o.negate(o),this.faceNormals[t]=o;var i=this.vertices[this.faces[t][0]];if(o.dot(i)<0){console.warn(".faceNormals["+t+"] = Vec3("+o.toString()+") looks like it points into the shape? The vertices follow. Make sure they are  ordered CCW around the normal, using the right hand rule.");for(var e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}}},e.computeNormal=function(t,e,o,i){var r=new n.a,s=new n.a;e.vsub(t,s),o.vsub(e,r),r.cross(s,i),i.isZero()||i.normalize()},e.prototype.getFaceNormal=function(t,o){var i=this.faces[t],n=this.vertices[i[0]],r=this.vertices[i[1]],s=this.vertices[i[2]];return e.computeNormal(n,r,s,o)},e.prototype.clipAgainstHull=function(t,e,o,i,r,s,a,u,h){for(var l=new n.a,p=l,c=-1,d=-Number.MAX_VALUE,v=0;v<o.faces.length;v++){p.copy(o.faceNormals[v]),r.vmult(p,p);var f=p.dot(s);f>d&&(d=f,c=v)}for(var y=[],m=o.faces[c],w=m.length,_=0;_<w;_++){var x=o.vertices[m[_]],b=new n.a;b.copy(x),r.vmult(b,b),i.vadd(b,b),y.push(b)}c>=0&&this.clipFaceAgainstHull(s,t,e,y,a,u,h)},e.prototype.findSeparatingAxis=function(t,e,o,i,r,s,a,u){var h=new n.a,l=new n.a,p=new n.a,c=new n.a,d=new n.a,v=new n.a,f=h,y=l,m=p,w=c,_=d,x=v,b=Number.MAX_VALUE,g=this,E=0;if(g.uniqueAxes)for(var B=0;B!==g.uniqueAxes.length;B++){o.vmult(g.uniqueAxes[B],f);var P=g.testSepAxis(f,t,e,o,i,r);if(!1===P)return!1;P<b&&(b=P,s.copy(f))}else for(var z=a?a.length:g.faces.length,B=0;B<z;B++){var C=a?a[B]:B;f.copy(g.faceNormals[C]),o.vmult(f,f);var P=g.testSepAxis(f,t,e,o,i,r);if(!1===P)return!1;P<b&&(b=P,s.copy(f))}if(t.uniqueAxes)for(var B=0;B!==t.uniqueAxes.length;B++){r.vmult(t.uniqueAxes[B],y),E++;var P=g.testSepAxis(y,t,e,o,i,r);if(!1===P)return!1;P<b&&(b=P,s.copy(y))}else for(var A=u?u.length:t.faces.length,B=0;B<A;B++){var C=u?u[B]:B;y.copy(t.faceNormals[C]),r.vmult(y,y),E++;var P=g.testSepAxis(y,t,e,o,i,r);if(!1===P)return!1;P<b&&(b=P,s.copy(y))}for(var S=0;S!==g.uniqueEdges.length;S++){o.vmult(g.uniqueEdges[S],w);for(var M=0;M!==t.uniqueEdges.length;M++)if(r.vmult(t.uniqueEdges[M],_),w.cross(_,x),!x.almostZero()){x.normalize();var q=g.testSepAxis(x,t,e,o,i,r);if(!1===q)return!1;q<b&&(b=q,s.copy(x))}}return i.vsub(e,m),m.dot(s)>0&&s.negate(s),!0},e.prototype.testSepAxis=function(t,o,i,n,r,s){var a=[],u=[],h=this;e.project(h,t,i,n,a),e.project(o,t,r,s,u);var l=a[0],p=a[1],c=u[0],d=u[1];if(l<d||c<p)return!1;var v=l-d,f=c-p;return v<f?v:f},e.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(this.cli_aabbmin,this.cli_aabbmax);var o=this.cli_aabbmax.x-this.cli_aabbmin.x,i=this.cli_aabbmax.y-this.cli_aabbmin.y,n=this.cli_aabbmax.z-this.cli_aabbmin.z;e.x=1/12*t*(2*i*2*i+2*n*2*n),e.y=1/12*t*(2*o*2*o+2*n*2*n),e.z=1/12*t*(2*i*2*i+2*o*2*o)},e.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],o=this.faceNormals[t],i=this.vertices[e[0]];return-o.dot(i)},e.prototype.clipFaceAgainstHull=function(t,e,o,i,r,s,a){for(var u=new n.a,h=new n.a,l=new n.a,p=new n.a,c=new n.a,d=new n.a,v=new n.a,f=new n.a,y=u,m=h,w=l,_=p,x=c,b=d,g=v,E=f,B=this,P=[],z=i,C=P,A=-1,S=Number.MAX_VALUE,M=0;M<B.faces.length;M++){y.copy(B.faceNormals[M]),o.vmult(y,y);var q=y.dot(t);q<S&&(S=q,A=M)}if(!(A<0)){for(var N=B.faces[A],j=[],F=0;F<B.faces.length;F++)for(var I=0;I<B.faces[F].length;I++)-1!==N.indexOf(B.faces[F][I])&&F!==A&&-1===j.indexOf(F)&&j.push(F);for(var R,O=(z.length,N.length),T=0;T<O;T++){var W=B.vertices[N[T]],L=B.vertices[N[(T+1)%O]];W.vsub(L,m),w.copy(m),o.vmult(w,w),e.vadd(w,w),_.copy(this.faceNormals[A]),o.vmult(_,_),e.vadd(_,_),w.cross(_,x),x.negate(x),b.copy(W),o.vmult(b,b),e.vadd(b,b);var k=-b.dot(x),V=j[T];if(void 0!=V){g.copy(this.faceNormals[V]);var U=this.getPlaneConstantOfFace(V);E.copy(g),o.vmult(E,E),R=U-E.dot(e)}else E.copy(x),R=k;for(this.clipFaceAgainstPlane(z,C,E,R);z.length;)z.shift();for(;C.length;)z.push(C.shift())}g.copy(this.faceNormals[A]);var G=this.getPlaneConstantOfFace(A);E.copy(g),o.vmult(E,E),R=G-E.dot(e);for(var F=0;F<z.length;F++){var D=E.dot(z[F])+R;if(D<=r&&(D=r),D<=s){var X=z[F];if(D<=0){var Y={point:X,normal:E,depth:D};a.push(Y)}}}}},e.prototype.clipFaceAgainstPlane=function(t,e,o,i){var r,s,a=t.length;if(a<2)return e;var u=t[t.length-1],h=t[0];r=o.dot(u)+i;for(var l=0;l<a;l++){if(h=t[l],s=o.dot(h)+i,r<0)if(s<0){var p=new n.a;p.copy(h),e.push(p)}else{var p=new n.a;u.lerp(h,r/(r-s),p),e.push(p)}else if(s<0){var p=new n.a;u.lerp(h,r/(r-s),p),e.push(p),e.push(h)}u=h,r=s}return e},e.prototype.computeWorldVertices=function(t,e){for(var o=this.vertices.length;this.worldVertices.length<o;)this.worldVertices.push(new n.a);for(var i=this.vertices,r=this.worldVertices,s=0;s!==o;s++)e.vmult(i[s],r[s]),t.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1},e.prototype.computeLocalAABB=function(t,e){var o=(new n.a,this.vertices.length),i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<o;r++){var s=i[r];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}},e.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new n.a);for(var o=this.faceNormals,i=this.worldFaceNormals,r=0;r!==e;r++)t.vmult(o[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},e.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,o=0,i=e.length;o!==i;o++){var n=e[o].norm2();n>t&&(t=n)}this.boundingSphereRadius=Math.sqrt(t)},e.prototype.calculateWorldAABB=function(t,e,o,i){for(var r,s,a,u,h,l,p=new n.a,c=this.vertices.length,d=this.vertices,v=0;v<c;v++){p.copy(d[v]),e.vmult(p,p),t.vadd(p,p);var f=p;f.x<r||void 0===r?r=f.x:(f.x>u||void 0===u)&&(u=f.x),f.y<s||void 0===s?s=f.y:(f.y>h||void 0===h)&&(h=f.y),f.z<a||void 0===a?a=f.z:(f.z>l||void 0===l)&&(l=f.z)}o.set(r,s,a),i.set(u,h,l)},e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},e.prototype.getAveragePointLocal=function(t){t=t||new n.a;for(var e=this.vertices.length,o=this.vertices,i=0;i<e;i++)t.vadd(o[i],t);return t.mult(1/e,t),t},e.prototype.transformAllPoints=function(t,e){var o=this.vertices.length,i=this.vertices;if(e){for(var n=0;n<o;n++){var r=i[n];e.vmult(r,r)}for(var n=0;n<this.faceNormals.length;n++){var r=this.faceNormals[n];e.vmult(r,r)}}if(t)for(var n=0;n<o;n++){var r=i[n];r.vadd(t,r)}},e.prototype.pointIsInside=function(t){var e=new n.a,o=new n.a,i=new n.a,r=this.vertices,s=this.faces,a=this.faceNormals,u=this.faces.length,h=e;this.getAveragePointLocal(h);for(var l=0;l<u;l++){var p=(this.faces[l].length,a[l]),c=r[s[l][0]],d=o;t.vsub(c,d);var v=p.dot(d),f=i;h.vsub(c,f);var y=p.dot(f);if(v<0&&y>0||v>0&&y<0)return!1}return-1},e.project=function(t,e,o,i,s){var a=(new n.a,new n.a),u=new n.a,h=t.vertices.length,l=a,p=u,c=t.vertices,d=0,v=0;p.setZero(),r.a.vectorToLocalFrame(o,i,e,l),r.a.pointToLocalFrame(o,i,p,p);var f=p.dot(l);v=d=c[0].dot(l);for(var y=1;y<h;y++){var m=c[y].dot(l);m>d&&(d=m),m<v&&(v=m)}if(v-=f,d-=f,v>d){var w=v;v=d,d=w}s[0]=d,s[1]=v},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(16),n=o(0),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(e,o,i){void 0===i&&(i=1e6);var r=t.call(this,e,o,0,i)||this;return r.ContactEquation_computeB_temp1=new n.a,r.ContactEquation_computeB_temp2=new n.a,r.ContactEquation_computeB_temp3=new n.a,r.ContactEquation_getImpactVelocityAlongNormal_vi=new n.a,r.ContactEquation_getImpactVelocityAlongNormal_vj=new n.a,r.ContactEquation_getImpactVelocityAlongNormal_xi=new n.a,r.ContactEquation_getImpactVelocityAlongNormal_xj=new n.a,r.ContactEquation_getImpactVelocityAlongNormal_relVel=new n.a,r.restitution=0,r.ri=new n.a,r.rj=new n.a,r.ni=new n.a,r}return r(e,t),e.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.bi,n=this.bj,r=this.ri,s=this.rj,a=this.ContactEquation_computeB_temp1,u=this.ContactEquation_computeB_temp2,h=i.velocity,l=i.angularVelocity,p=(i.force,i.torque,n.velocity),c=n.angularVelocity,d=(n.force,n.torque,this.ContactEquation_computeB_temp3),v=this.jacobianElementA,f=this.jacobianElementB,y=this.ni;r.cross(y,a),s.cross(y,u),y.negate(v.spatial),a.negate(v.rotational),f.spatial.copy(y),f.rotational.copy(u),d.copy(n.position),d.vadd(s,d),d.vsub(i.position,d),d.vsub(r,d);var m=y.dot(d),w=this.restitution+1;return-m*e-(w*p.dot(y)-w*h.dot(y)+c.dot(u)-l.dot(a))*o-t*this.computeGiMf()},e.prototype.getImpactVelocityAlongNormal=function(){var t=this.ContactEquation_getImpactVelocityAlongNormal_vi,e=this.ContactEquation_getImpactVelocityAlongNormal_vj,o=this.ContactEquation_getImpactVelocityAlongNormal_xi,i=this.ContactEquation_getImpactVelocityAlongNormal_xj,n=this.ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(o,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,n),this.ni.dot(n)},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){this.equations=[]}return t.prototype.solve=function(t,e){return 0},t.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},t.prototype.removeEquation=function(t){var e=this.equations,o=e.indexOf(t);-1!==o&&e.splice(o,1)},t.prototype.removeAllEquations=function(){this.equations.length=0},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(0),n=function(){function t(){this.rayFromWorld=new i.a,this.rayToWorld=new i.a,this.hitNormalWorld=new i.a,this.hitPointWorld=new i.a,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}return t.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},t.prototype.abort=function(){this._shouldStop=!0},t.prototype.set=function(t,e,o,i,n,r,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(i),this.shape=n,this.body=r,this.distance=s},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){this.matrix=[]}return t.prototype.get=function(t,e){var o=t.index,i=e.index;if(i>o){var n=i;i=o,o=n}return this.matrix[(o*(o+1)>>1)+i-1]},t.prototype.set=function(t,e,o){var i=t.index,n=e.index;if(n>i){var r=n;n=i,i=r}this.matrix[(i*(i+1)>>1)+n-1]=o?1:0},t.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},t.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return a});var i=o(1),n=o(0),r=o(7),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),a=function(t){function e(e){var o=t.call(this,{type:i.a.types.BOX})||this;return o.worldCornerTempPos=new n.a,o.worldCornerTempNeg=new n.a,o.worldCornersTemp=[new n.a,new n.a,new n.a,new n.a,new n.a,new n.a,new n.a,new n.a],o.halfExtents=e,o.convexPolyhedronRepresentation=null,o.updateConvexPolyhedronRepresentation(),o.updateBoundingSphereRadius(),o}return s(e,t),e.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,o=this.halfExtents.z,i=n.a,s=[new i(-t,-e,-o),new i(t,-e,-o),new i(t,e,-o),new i(-t,e,-o),new i(-t,-e,o),new i(t,-e,o),new i(t,e,o),new i(-t,e,o)],a=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],u=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new r.a(s,a));this.convexPolyhedronRepresentation=u,u.material=this.material},e.prototype.calculateLocalInertia=function(t,o){return o=o||new n.a,e.calculateInertia(this.halfExtents,t,o),o},e.calculateInertia=function(t,e,o){var i=t;o.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),o.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),o.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},e.prototype.getSideNormals=function(t,e){var o=t,i=this.halfExtents;if(o[0].set(i.x,0,0),o[1].set(0,i.y,0),o[2].set(0,0,i.z),o[3].set(-i.x,0,0),o[4].set(0,-i.y,0),o[5].set(0,0,-i.z),void 0!==e)for(var n=0;n!==o.length;n++)e.vmult(o[n],o[n]);return o},e.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()},e.prototype.forEachWorldCorner=function(t,e,o){for(var i=this.halfExtents,n=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],r=0;r<n.length;r++)this.worldCornerTempPos.set(n[r][0],n[r][1],n[r][2]),e.vmult(this.worldCornerTempPos,this.worldCornerTempPos),t.vadd(this.worldCornerTempPos,this.worldCornerTempPos),o(this.worldCornerTempPos.x,this.worldCornerTempPos.y,this.worldCornerTempPos.z)},e.prototype.calculateWorldAABB=function(t,e,o,i){var n=this.halfExtents;this.worldCornersTemp[0].set(n.x,n.y,n.z),this.worldCornersTemp[1].set(-n.x,n.y,n.z),this.worldCornersTemp[2].set(-n.x,-n.y,n.z),this.worldCornersTemp[3].set(-n.x,-n.y,-n.z),this.worldCornersTemp[4].set(n.x,-n.y,-n.z),this.worldCornersTemp[5].set(n.x,n.y,-n.z),this.worldCornersTemp[6].set(-n.x,n.y,-n.z),this.worldCornersTemp[7].set(n.x,-n.y,n.z);var r=this.worldCornersTemp[0];e.vmult(r,r),t.vadd(r,r),i.copy(r),o.copy(r);for(var s=1;s<8;s++){var a=this.worldCornersTemp[s];e.vmult(a,a),t.vadd(a,a);var u=a.x,h=a.y,l=a.z;u>i.x&&(i.x=u),h>i.y&&(i.y=h),l>i.z&&(i.z=l),u<o.x&&(o.x=u),h<o.y&&(o.y=h),l<o.z&&(o.z=l)}},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return r});var i=o(0),n=o(2),r=function(){function t(t){t=t||{},this.position=new i.a,t.position&&this.position.copy(t.position),this.quaternion=new n.a,t.quaternion&&this.quaternion.copy(t.quaternion)}return t.pointToLocalFrame=function(t,e,o,r){var s=new n.a;return r=r||new i.a,o.vsub(t,r),e.conjugate(s),s.vmult(r,r),r},t.pointToWorldFrame=function(t,e,o,n){return n=n||new i.a,e.vmult(o,n),n.vadd(t,n),n},t.vectorToWorldFrame=function(t,e,o){return o=o||new i.a,t.vmult(e,o),o},t.vectorToLocalFrame=function(t,e,o,n){return n=n||new i.a,e.w*=-1,e.vmult(o,n),e.w*=-1,n},t.prototype.pointToLocal=function(e,o){return t.pointToLocalFrame(this.position,this.quaternion,e,o)},t.prototype.pointToWorld=function(e,o){return t.pointToWorldFrame(this.position,this.quaternion,e,o)},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(3),n=o(0),r=o(2),s=function(){function t(){this.Broadphase_collisionPairs_r=new n.a,this.Broadphase_collisionPairs_normal=new n.a,this.Broadphase_collisionPairs_quat=new r.a,this.Broadphase_collisionPairs_relpos=new n.a,this.Broadphase_makePairsUnique_p1=[],this.Broadphase_makePairsUnique_p2=[],this.bsc_dist=new n.a,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}return t.prototype.collisionPairs=function(t,e,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")},t.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&i.a.STATIC)&&t.sleepState!==i.a.SLEEPING||0==(e.type&i.a.STATIC)&&e.sleepState!==i.a.SLEEPING)},t.prototype.intersectionTest=function(t,e,o,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,o,i):this.doBoundingSphereBroadphase(t,e,o,i)},t.prototype.doBoundingSphereBroadphase=function(t,e,o,i){var n=this.Broadphase_collisionPairs_r;e.position.vsub(t.position,n);var r=Math.pow(t.boundingRadius+e.boundingRadius,2);n.norm2()<r&&(o.push(t),i.push(e))},t.prototype.doBoundingBoxBroadphase=function(t,e,o,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(o.push(t),i.push(e))},t.prototype.makePairsUnique=function(t,e){for(var o=this.Broadphase_makePairsUnique_temp,i=this.Broadphase_makePairsUnique_p1,n=this.Broadphase_makePairsUnique_p2,r=t.length,s=0;s!==r;s++)i[s]=t[s],n[s]=e[s];t.length=0,e.length=0;for(var s=0;s!==r;s++){var a=i[s].id,u=n[s].id,h=a<u?a+","+u:u+","+a;o[h]=s,o.keys.push(h)}for(var s=0;s!==o.keys.length;s++){var h=o.keys.pop(),l=o[h];t.push(i[l]),e.push(n[l]),delete o[h]}},t.prototype.setWorld=function(t){},t.boundingSphereCheck=function(t,e){var o=new n.a;t.position.vsub(e.position,o);var i=t.shapes[0],r=e.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>o.norm2()},t.prototype.aabbQuery=function(t,e,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){}return t.defaults=function(t,e){t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return r});var i=o(17),n=o(0),r=function(){function t(e,o,r,s){this.id=0,this.zero=new n.a,this.iMfi=new n.a,this.iMfj=new n.a,this.invIi_vmult_taui=new n.a,this.invIj_vmult_tauj=new n.a,this.tmp=new n.a,this.addToWlambda_temp=new n.a,this.addToWlambda_Gi=new n.a,this.addToWlambda_Gj=new n.a,this.addToWlambda_ri=new n.a,this.addToWlambda_rj=new n.a,this.addToWlambda_Mdiag=new n.a,this.id=t.EquationId++,this.minForce=void 0===r?-1e6:r,this.maxForce=void 0===s?1e6:s,this.bi=e,this.bj=o,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i.a,this.jacobianElementB=new i.a,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}return t.prototype.setSpookParams=function(t,e,o){var i=e,n=t,r=o;this.a=4/(r*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(r*r*n*(1+4*i))},t.prototype.computeB=function(t,e,o){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*o},t.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.position,r=i.position;return t.spatial.dot(n)+e.spatial.dot(r)},t.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.velocity,r=i.velocity,s=o.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(n,s)+e.multiplyVectors(r,a)},t.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.vlambda,r=i.vlambda,s=o.wlambda,a=i.wlambda;return t.multiplyVectors(n,s)+e.multiplyVectors(r,a)},t.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.force,r=o.torque,s=i.force,a=i.torque,u=o.invMassSolve,h=i.invMassSolve;return n.scale(u,this.iMfi),s.scale(h,this.iMfj),o.invInertiaWorldSolve.vmult(r,this.invIi_vmult_taui),i.invInertiaWorldSolve.vmult(a,this.invIj_vmult_tauj),t.multiplyVectors(this.iMfi,this.invIi_vmult_taui)+e.multiplyVectors(this.iMfj,this.invIj_vmult_tauj)},t.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.invMassSolve,r=i.invMassSolve,s=o.invInertiaWorldSolve,a=i.invInertiaWorldSolve,u=n+r;return s.vmult(t.rotational,this.tmp),u+=this.tmp.dot(t.rotational),a.vmult(e.rotational,this.tmp),u+=this.tmp.dot(e.rotational)},t.prototype.addToWlambda=function(t){var e=this.jacobianElementA,o=this.jacobianElementB,i=this.bi,n=this.bj,r=this.addToWlambda_temp;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),n.vlambda.addScaledVector(n.invMassSolve*t,o.spatial,n.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,r),i.wlambda.addScaledVector(t,r,i.wlambda),n.invInertiaWorldSolve.vmult(o.rotational,r),n.wlambda.addScaledVector(t,r,n.wlambda)},t.prototype.computeC=function(){return this.computeGiMGt()+this.eps},t.EquationId=0,t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(0),n=function(){function t(){this.spatial=new i.a,this.rotational=new i.a}return t.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},t.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return l});var i=o(19),n=o(1),r=o(3),s=o(8),a=o(0),u=o(2),h=o(21),l=function(){function t(t){this.averageNormal=new a.a,this.averageContactPointA=new a.a,this.averageContactPointB=new a.a,this.tmpVec1=new a.a,this.tmpVec2=new a.a,this.tmpQuat1=new u.a,this.tmpQuat2=new u.a,this.point_on_plane_to_sphere=new a.a,this.plane_to_sphere_ortho=new a.a,this.pointInPolygon_edge=new a.a,this.pointInPolygon_edge_x_normal=new a.a,this.pointInPolygon_vtp=new a.a,this.box_to_sphere=new a.a,this.sphereBox_ns=new a.a,this.sphereBox_ns1=new a.a,this.sphereBox_ns2=new a.a,this.sphereBox_sides=[new a.a,new a.a,new a.a,new a.a,new a.a,new a.a],this.sphereBox_sphere_to_corner=new a.a,this.sphereBox_side_ns=new a.a,this.sphereBox_side_ns1=new a.a,this.sphereBox_side_ns2=new a.a,this.convex_to_sphere=new a.a,this.sphereConvex_edge=new a.a,this.sphereConvex_edgeUnit=new a.a,this.sphereConvex_sphereToCorner=new a.a,this.sphereConvex_worldCorner=new a.a,this.sphereConvex_worldNormal=new a.a,this.sphereConvex_worldPoint=new a.a,this.sphereConvex_worldSpherePointClosestToPlane=new a.a,this.sphereConvex_penetrationVec=new a.a,this.sphereConvex_sphereToWorldPoint=new a.a,this.planeBox_normal=new a.a,this.plane_to_corner=new a.a,this.planeConvex_v=new a.a,this.planeConvex_normal=new a.a,this.planeConvex_relpos=new a.a,this.planeConvex_projected=new a.a,this.convexConvex_sepAxis=new a.a,this.convexConvex_q=new a.a,this.particlePlane_normal=new a.a,this.particlePlane_relpos=new a.a,this.particlePlane_projected=new a.a,this.particleSphere_normal=new a.a,this.cqj=new u.a,this.convexParticle_local=new a.a,this.convexParticle_normal=new a.a,this.convexParticle_penetratedFaceNormal=new a.a,this.convexParticle_vertexToParticle=new a.a,this.convexParticle_worldPenetrationVec=new a.a,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new i.a,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}return t.prototype.createContactEquation=function(t,e,o,i,n,r){var a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=t,a.bj=e):a=new s.a(t,e),a.enabled=t.collisionResponse&&e.collisionResponse&&o.collisionResponse&&i.collisionResponse;var u=this.currentContactMaterial;a.restitution=u.restitution,a.setSpookParams(u.contactEquationStiffness,u.contactEquationRelaxation,this.world.dt);var h=o.material||t.material,l=i.material||e.material;return h&&l&&h.restitution>=0&&l.restitution>=0&&(a.restitution=h.restitution*l.restitution),a.si=n||o,a.sj=r||i,a},t.prototype.createFrictionEquationsFromContact=function(t,e){var o=t.bi,i=t.bj,n=t.si,r=t.sj,s=this.world,a=this.currentContactMaterial,u=a.friction,l=n.material||o.material,p=r.material||i.material;if(l&&p&&l.friction>=0&&p.friction>=0&&(u=l.friction*p.friction),u>0){var c=u*s.gravity.length(),d=o.invMass+i.invMass;d>0&&(d=1/d);var v=this.frictionEquationPool,f=v.length?v.pop():new h.a(o,i,c*d),y=v.length?v.pop():new h.a(o,i,c*d);return f.bi=y.bi=o,f.bj=y.bj=i,f.minForce=y.minForce=-c*d,f.maxForce=y.maxForce=c*d,f.ri.copy(t.ri),f.rj.copy(t.rj),y.ri.copy(t.ri),y.rj.copy(t.rj),t.ni.tangents(f.t,y.t),f.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),y.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),f.enabled=y.enabled=t.enabled,e.push(f,y),!0}return!1},t.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var o=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];this.averageNormal.setZero(),this.averageContactPointA.setZero(),this.averageContactPointB.setZero();for(var n=e.bi,r=(e.bj,0);r!==t;r++)e=this.result[this.result.length-1-r],e.bodyA!==n?(this.averageNormal.vadd(e.ni,this.averageNormal),this.averageContactPointA.vadd(e.ri,this.averageContactPointA),this.averageContactPointB.vadd(e.rj,this.averageContactPointB)):(this.averageNormal.vsub(e.ni,this.averageNormal),this.averageContactPointA.vadd(e.rj,this.averageContactPointA),this.averageContactPointB.vadd(e.ri,this.averageContactPointB));var s=1/t;this.averageContactPointA.scale(s,o.ri),this.averageContactPointB.scale(s,o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj),this.averageNormal.normalize(),this.averageNormal.tangents(o.t,i.t)}},t.prototype.getContacts=function(t,e,o,i,s,a,u){this.contactPointPool=s,this.frictionEquationPool=u,this.result=i,this.frictionResult=a;for(var h=this.tmpQuat1,l=this.tmpQuat2,p=this.tmpVec1,c=this.tmpVec2,d=0,v=t.length;d!==v;d++){var f=t[d],y=e[d],m=null;f.material&&y.material&&(m=o.getContactMaterial(f.material,y.material)||null);for(var w=!!(f.type&r.a.KINEMATIC&&y.type&r.a.STATIC||f.type&r.a.STATIC&&y.type&r.a.KINEMATIC||f.type&r.a.KINEMATIC&&y.type&r.a.KINEMATIC),_=0;_<f.shapes.length;_++){f.quaternion.mult(f.shapeOrientations[_],h),f.quaternion.vmult(f.shapeOffsets[_],p),p.vadd(f.position,p);for(var x=f.shapes[_],b=0;b<y.shapes.length;b++){y.quaternion.mult(y.shapeOrientations[b],l),y.quaternion.vmult(y.shapeOffsets[b],c),c.vadd(y.position,c);var g=y.shapes[b];if(x.collisionFilterMask&g.collisionFilterGroup&&g.collisionFilterMask&x.collisionFilterGroup&&!(p.distanceTo(c)>x.boundingSphereRadius+g.boundingSphereRadius)){var E=null;x.material&&g.material&&(E=o.getContactMaterial(x.material,g.material)||null),this.currentContactMaterial=E||m||o.defaultContactMaterial;var B=x.type<g.type,P=!1;switch(x.type|g.type){case n.a.types.CONVEXPOLYHEDRON|n.a.types.CONVEXPOLYHEDRON:P=B?this.convexConvex(x,g,p,c,h,l,f,y,x,g,w):this.convexConvex(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.CONVEXPOLYHEDRON|n.a.types.PARTICLE:P=B?this.convexParticle(x,g,p,c,h,l,f,y,x,g,w):this.convexParticle(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.BOX|n.a.types.CONVEXPOLYHEDRON:P=B?this.boxConvex(x,g,p,c,h,l,f,y,x,g,w):this.boxConvex(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.SPHERE|n.a.types.CONVEXPOLYHEDRON:P=B?this.sphereConvex(x,g,p,c,h,l,f,y,x,g,w):this.sphereConvex(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.BOX|n.a.types.BOX:P=B?this.boxBox(x,g,p,c,h,l,f,y,x,g,w):this.boxBox(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.BOX|n.a.types.PARTICLE:P=B?this.boxParticle(x,g,p,c,h,l,f,y,x,g,w):this.boxParticle(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.SPHERE|n.a.types.BOX:P=B?this.sphereBox(x,g,p,c,h,l,f,y,x,g,w):this.sphereBox(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.SPHERE|n.a.types.SPHERE:P=B?this.sphereSphere(x,g,p,c,h,l,f,y,x,g,w):this.sphereSphere(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.SPHERE|n.a.types.PLANE:P=B?this.spherePlane(x,g,p,c,h,l,f,y,x,g,w):this.spherePlane(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.SPHERE|n.a.types.PARTICLE:P=B?this.sphereParticle(x,g,p,c,h,l,f,y,x,g,w):this.sphereParticle(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.PLANE|n.a.types.BOX:P=B?this.planeBox(x,g,p,c,h,l,f,y,x,g,w):this.planeBox(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.PLANE|n.a.types.CONVEXPOLYHEDRON:P=B?this.planeConvex(x,g,p,c,h,l,f,y,x,g,w):this.planeConvex(g,x,c,p,l,h,y,f,g,x,w);break;case n.a.types.PLANE|n.a.types.PARTICLE:P=B?this.planeParticle(x,g,p,c,h,l,f,y,x,g,w):this.planeParticle(g,x,c,p,l,h,y,f,g,x,w)}P&&w&&(o.shapeOverlapKeeper.set(x.id,g.id),o.bodyOverlapKeeper.set(f.id,y.id))}}}}},t.prototype.boxBox=function(t,e,o,i,n,r,s,a,u,h,l){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,o,i,n,r,s,a,t,e,l)},t.prototype.boxConvex=function(t,e,o,i,n,r,s,a,u,h,l){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,o,i,n,r,s,a,t,e,l)},t.prototype.boxParticle=function(t,e,o,i,n,r,s,a,u,h,l){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,o,i,n,r,s,a,t,e,l)},t.prototype.sphereSphere=function(t,e,o,i,n,r,s,a,u,h,l){var p=t,c=e;if(l)return o.distanceSquared(i)<Math.pow(p.radius+c.radius,2);var d=this.createContactEquation(s,a,t,e,u,h);return i.vsub(o,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.mult(p.radius,d.ri),d.rj.mult(-c.radius,d.rj),d.ri.vadd(o,d.ri),d.ri.vsub(s.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult),!1},t.prototype.spherePlane=function(t,e,o,i,n,r,s,a,u,h,l){var p=this.createContactEquation(s,a,t,e,u,h);p.ni.set(0,0,1),r.vmult(p.ni,p.ni),p.ni.negate(p.ni),p.ni.normalize();var c=t;if(p.ni.mult(c.radius,p.ri),o.vsub(i,this.point_on_plane_to_sphere),p.ni.mult(p.ni.dot(this.point_on_plane_to_sphere),this.plane_to_sphere_ortho),this.point_on_plane_to_sphere.vsub(this.plane_to_sphere_ortho,p.rj),-this.point_on_plane_to_sphere.dot(p.ni)<=c.radius){if(l)return!0;var d=p.ri,v=p.rj;d.vadd(o,d),d.vsub(s.position,d),v.vadd(i,v),v.vsub(a.position,v),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}return!1},t.prototype.pointInPolygon=function(t,e,o){for(var i=null,n=t.length,r=0;r!==n;r++){var s=t[r],a=this.pointInPolygon_edge;t[(r+1)%n].vsub(s,a);var u=this.pointInPolygon_edge_x_normal;a.cross(e,u);var h=this.pointInPolygon_vtp;o.vsub(s,h);var l=u.dot(h);if(!(null===i||l>0&&!0===i||l<=0&&!1===i))return!1;null===i&&(i=l>0)}return!0},t.prototype.sphereBox=function(t,e,o,i,n,r,s,a,u,h,l){var p=this.v3pool,c=t,d=e,v=this.sphereBox_sides;o.vsub(i,this.box_to_sphere),d.getSideNormals(v,r);for(var f=c.radius,y=!1,m=this.sphereBox_side_ns,w=this.sphereBox_side_ns1,_=this.sphereBox_side_ns2,x=null,b=0,g=0,E=0,B=null,P=0,z=v.length;P!==z&&!1===y;P++){var C=this.sphereBox_ns;C.copy(v[P]);var A=C.norm();C.normalize();var S=this.box_to_sphere.dot(C);if(S<A+f&&S>0){var M=this.sphereBox_ns1,q=this.sphereBox_ns2;M.copy(v[(P+1)%3]),q.copy(v[(P+2)%3]);var N=M.norm(),j=q.norm();M.normalize(),q.normalize();var F=this.box_to_sphere.dot(M),I=this.box_to_sphere.dot(q);if(F<N&&F>-N&&I<j&&I>-j){var R=Math.abs(S-A-f);if((null===B||R<B)&&(B=R,g=F,E=I,x=A,m.copy(C),w.copy(M),_.copy(q),b++,l))return!0}}}if(b){y=!0;var O=this.createContactEquation(s,a,t,e,u,h);m.mult(-f,O.ri),O.ni.copy(m),O.ni.negate(O.ni),m.mult(x,m),w.mult(g,w),m.vadd(w,m),_.mult(E,_),m.vadd(_,O.rj),O.ri.vadd(o,O.ri),O.ri.vsub(s.position,O.ri),O.rj.vadd(i,O.rj),O.rj.vsub(a.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}for(var T=p.get(),W=this.sphereBox_sphere_to_corner,L=0;2!==L&&!y;L++)for(var k=0;2!==k&&!y;k++)for(var V=0;2!==V&&!y;V++)if(T.set(0,0,0),L?T.vadd(v[0],T):T.vsub(v[0],T),k?T.vadd(v[1],T):T.vsub(v[1],T),V?T.vadd(v[2],T):T.vsub(v[2],T),i.vadd(T,W),W.vsub(o,W),W.norm2()<f*f){if(l)return!0;y=!0;var O=this.createContactEquation(s,a,t,e,u,h);O.ri.copy(W),O.ri.normalize(),O.ni.copy(O.ri),O.ri.mult(f,O.ri),O.rj.copy(T),O.ri.vadd(o,O.ri),O.ri.vsub(s.position,O.ri),O.rj.vadd(i,O.rj),O.rj.vsub(a.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}p.release(T),T=null;for(var U=p.get(),G=p.get(),D=p.get(),X=p.get(),Y=p.get(),H=v.length,L=0;L!==H&&!y;L++)for(var k=0;k!==H&&!y;k++)if(L%3!=k%3){v[k].cross(v[L],U),U.normalize(),v[L].vadd(v[k],G),D.copy(o),D.vsub(G,D),D.vsub(i,D);var Q=D.dot(U);U.mult(Q,X);for(var V=0;V===L%3||V===k%3;)V++;Y.copy(o),Y.vsub(X,Y),Y.vsub(G,Y),Y.vsub(i,Y);var Z=Math.abs(Q),K=Y.norm();if(Z<v[V].norm()&&K<f){if(l)return!0;y=!0;var J=this.createContactEquation(s,a,t,e,u,h);G.vadd(X,J.rj),J.rj.copy(J.rj),Y.negate(J.ni),J.ni.normalize(),J.ri.copy(J.rj),J.ri.vadd(i,J.ri),J.ri.vsub(o,J.ri),J.ri.normalize(),J.ri.mult(f,J.ri),J.ri.vadd(o,J.ri),J.ri.vsub(s.position,J.ri),J.rj.vadd(i,J.rj),J.rj.vsub(a.position,J.rj),this.result.push(J),this.createFrictionEquationsFromContact(J,this.frictionResult)}}return p.release(U,G,D,X,Y),!1},t.prototype.sphereConvex=function(t,e,o,i,n,r,s,a,u,h,l){var p=this.v3pool,c=t,d=e;o.vsub(i,this.convex_to_sphere);for(var v=d.faceNormals,f=d.faces,y=d.vertices,m=c.radius,w=0;w!==y.length;w++){var _=y[w],x=this.sphereConvex_worldCorner;r.vmult(_,x),i.vadd(x,x);var b=this.sphereConvex_sphereToCorner;if(x.vsub(o,b),b.norm2()<m*m){if(l)return!0;var g=this.createContactEquation(s,a,t,e,u,h);return g.ri.copy(b),g.ri.normalize(),g.ni.copy(g.ri),g.ri.mult(m,g.ri),x.vsub(i,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),g.rj.vadd(i,g.rj),g.rj.vsub(a.position,g.rj),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult),!1}}for(var E=!1,w=0,B=f.length;w!==B&&!1===E;w++){var P=v[w],z=f[w],C=this.sphereConvex_worldNormal;r.vmult(P,C);var A=this.sphereConvex_worldPoint;r.vmult(y[z[0]],A),A.vadd(i,A);var S=this.sphereConvex_worldSpherePointClosestToPlane;C.mult(-m,S),o.vadd(S,S);var M=this.sphereConvex_penetrationVec;S.vsub(A,M);var q=M.dot(C),N=this.sphereConvex_sphereToWorldPoint;if(o.vsub(A,N),q<0&&N.dot(C)>0){for(var j=[],F=0,I=z.length;F!==I;F++){var R=p.get();r.vmult(y[z[F]],R),i.vadd(R,R),j.push(R)}if(this.pointInPolygon(j,C,o)){if(l)return!0;E=!0;var g=this.createContactEquation(s,a,t,e,u,h);C.mult(-m,g.ri),C.negate(g.ni);var O=p.get();C.mult(-q,O);var T=p.get();C.mult(-m,T),o.vsub(i,g.rj),g.rj.vadd(T,g.rj),g.rj.vadd(O,g.rj),g.rj.vadd(i,g.rj),g.rj.vsub(a.position,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),p.release(O),p.release(T),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var F=0,W=j.length;F!==W;F++)p.release(j[F]);return!1}for(var F=0;F!==z.length;F++){var L=p.get(),k=p.get();r.vmult(y[z[(F+1)%z.length]],L),r.vmult(y[z[(F+2)%z.length]],k),i.vadd(L,L),i.vadd(k,k);var V=this.sphereConvex_edge;k.vsub(L,V);var U=this.sphereConvex_edgeUnit;V.unit(U);var G=p.get(),D=p.get();o.vsub(L,D);var X=D.dot(U);U.mult(X,G),G.vadd(L,G);var Y=p.get();if(G.vsub(o,Y),X>0&&X*X<V.norm2()&&Y.norm2()<m*m){if(l)return!0;var g=this.createContactEquation(s,a,t,e,u,h);G.vsub(i,g.rj),G.vsub(o,g.ni),g.ni.normalize(),g.ni.mult(m,g.ri),g.rj.vadd(i,g.rj),g.rj.vsub(a.position,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var H=0,W=j.length;H!==W;H++)p.release(j[H]);return p.release(L),p.release(k),p.release(G),p.release(Y),p.release(D),!1}p.release(L),p.release(k),p.release(G),p.release(Y),p.release(D)}for(var F=0,W=j.length;F!==W;F++)p.release(j[F])}}return!1},t.prototype.planeBox=function(t,e,o,i,n,r,s,a,u,h,l){var p=e;return p.convexPolyhedronRepresentation.material=e.material,p.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,p.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,p.convexPolyhedronRepresentation,o,i,n,r,s,a,t,e,l)},t.prototype.planeConvex=function(t,e,o,i,n,r,s,a,u,h,l){var p=t,c=e,d=o,v=i,f=n,y=r,m=s,w=a,_=this.planeConvex_v,x=this.planeConvex_normal;x.set(0,0,1),f.vmult(x,x);for(var b=0,g=this.planeConvex_relpos,E=0;E!==c.vertices.length;E++)if(_.copy(c.vertices[E]),y.vmult(_,_),v.vadd(_,_),_.vsub(d,g),x.dot(g)<=0){if(l)return!0;var B=this.createContactEquation(m,w,p,c,u,h),P=this.planeConvex_projected;x.mult(x.dot(g),P),_.vsub(P,P),P.vsub(d,B.ri),B.ni.copy(x),_.vsub(v,B.rj),B.ri.vadd(d,B.ri),B.ri.vsub(m.position,B.ri),B.rj.vadd(v,B.rj),B.rj.vsub(w.position,B.rj),this.result.push(B),b++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(B,this.frictionResult)}return this.enableFrictionReduction&&b&&this.createFrictionFromAverage(b),!1},t.prototype.convexConvex=function(t,e,o,i,n,r,s,a,u,h,l,p,c){var d=this.convexConvex_sepAxis;if(o.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)return!1;var v=t;if(v.findSeparatingAxis(v,o,n,i,r,d,p,c)){var f=[],y=this.convexConvex_q;v.clipAgainstHull(o,n,v,i,r,d,-100,100,f);for(var m=0,w=0;w!==f.length;w++){if(l)return!0;var _=this.createContactEquation(s,a,t,e,u,h),x=_.ri,b=_.rj;d.negate(_.ni),f[w].normal.negate(y),y.mult(f[w].depth,y),f[w].point.vadd(y,x),b.copy(f[w].point),x.vsub(o,x),b.vsub(i,b),x.vadd(o,x),x.vsub(s.position,x),b.vadd(i,b),b.vsub(a.position,b),this.result.push(_),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}return!1},t.prototype.planeParticle=function(t,e,o,i,n,r,s,a,u,h,l){var p=this.particlePlane_normal;p.set(0,0,1),a.quaternion.vmult(p,p);var c=this.particlePlane_relpos;if(o.vsub(a.position,c),p.dot(c)<=0){if(l)return!0;var d=this.createContactEquation(s,a,t,e,u,h);d.ni.copy(p),d.ni.negate(d.ni),d.ri.set(0,0,0);var v=this.particlePlane_projected;p.mult(p.dot(o),v),o.vsub(v,v),d.rj.copy(v),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}return!1},t.prototype.sphereParticle=function(t,e,o,i,n,r,s,a,u,h,l){var p=e,c=this.particleSphere_normal;if(c.set(0,0,1),o.vsub(i,c),c.norm2()<=p.radius*p.radius){if(l)return!0;var d=this.createContactEquation(s,a,t,e,u,h);c.normalize(),d.rj.copy(c),d.rj.mult(p.radius,d.rj),d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}return!1},t.prototype.convexParticle=function(t,e,o,i,n,r,s,a,u,h,l){var p=-1,c=this.convexParticle_penetratedFaceNormal,d=this.convexParticle_worldPenetrationVec,v=null,f=0,y=e,m=this.convexParticle_local;if(m.copy(o),m.vsub(i,m),r.conjugate(this.cqj),this.cqj.vmult(m,m),y.pointIsInside(m)){y.worldVerticesNeedsUpdate&&y.computeWorldVertices(i,r),y.worldFaceNormalsNeedsUpdate&&y.computeWorldFaceNormals(r);for(var w=0,_=y.faces.length;w!==_;w++){var x=[y.worldVertices[y.faces[w][0]]],b=y.worldFaceNormals[w];o.vsub(x[0],this.convexParticle_vertexToParticle);var g=-b.dot(this.convexParticle_vertexToParticle);if(null===v||Math.abs(g)<Math.abs(v)){if(l)return!0;v=g,p=w,c.copy(b),f++}}if(-1!==p){var E=this.createContactEquation(s,a,t,e,u,h);c.mult(v,d),d.vadd(o,d),d.vsub(i,d),E.rj.copy(d),c.negate(E.ni),E.ri.set(0,0,0);var B=E.ri,P=E.rj;B.vadd(o,B),B.vsub(s.position,B),P.vadd(i,P),P.vsub(a.position,P),this.result.push(E),this.createFrictionEquationsFromContact(E,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}return!1},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(0),n=o(20),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(){var e=t.call(this)||this;return e.type=i.a,e}return r(e,t),e.prototype.constructObject=function(){return new i.a},e}(n.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){this.objects=[],this.type=Object}return t.prototype.release=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=t.length,i=0;i!==o;i++)this.objects.push(t[i]);return this},t.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},t.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")},t.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this},t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(0),n=o(8),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(e,o,n){var r=t.call(this,e,o,n)||this;return r.FrictionEquation_computeB_temp1=new i.a,r.FrictionEquation_computeB_temp2=new i.a,r.ri=new i.a,r.rj=new i.a,r.t=new i.a,r}return r(e,t),e.prototype.computeB=function(t){var e=(this.a,this.b),o=(this.bi,this.bj,this.ri),i=this.rj,n=this.FrictionEquation_computeB_temp1,r=this.FrictionEquation_computeB_temp2,s=this.t;o.cross(s,n),i.cross(s,r);var a=this.jacobianElementA,u=this.jacobianElementB;return s.negate(a.spatial),n.negate(a.rotational),u.spatial.copy(s),u.rotational.copy(r),-this.computeGW()*e-t*this.computeGiMf()},e}(n.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(15),n=function(){function t(e,o,n){n=i.a.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=t.idCounter++,this.materials=[e,o],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}return t.idCounter=0,t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return r});var i=o(9),n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=function(t){function e(){var e=t.call(this)||this;return e.GSSolver_solve_lambda=[],e.GSSolver_solve_invCs=[],e.GSSolver_solve_Bs=[],e.iterations=10,e.tolerance=1e-7,e}return n(e,t),e.prototype.solve=function(t,e){var o,i,n,r,s,a,u=this.iterations,h=this.tolerance*this.tolerance,l=this.equations,p=l.length,c=e.bodies,d=c.length,v=t,f=0;if(0!==p)for(var y=0;y!==d;y++)c[y].updateSolveMassProperties();var m=this.GSSolver_solve_invCs,w=this.GSSolver_solve_Bs,_=this.GSSolver_solve_lambda;m.length=p,w.length=p,_.length=p;for(var x=0;x!==p;x++){var b=l[x];_[x]=0,w[x]=b.computeB(v),m[x]=1/b.computeC()}if(0!==p){for(var x=0;x!==d;x++){var g=c[x],E=g.vlambda,B=g.wlambda;E.set(0,0,0),B.set(0,0,0)}for(f=0;f!==u;f++){r=0;for(var P=0;P!==p;P++){var b=l[P];o=w[P],i=m[P],a=_[P],s=b.computeGWlambda(),n=i*(o-s-b.eps*a),a+n<b.minForce?n=b.minForce-a:a+n>b.maxForce&&(n=b.maxForce-a),_[P]+=n,r+=n>0?n:-n,b.addToWlambda(n)}if(r*r<h)break}for(var x=0;x!==d;x++){var g=c[x],z=g.velocity,C=g.angularVelocity;g.vlambda.vmul(g.linearFactor,g.vlambda),z.vadd(g.vlambda,z),g.wlambda.vmul(g.angularFactor,g.wlambda),C.vadd(g.wlambda,C)}for(var A=l.length,S=1/v;A--;)l[A].multiplier=_[A]*S}return f},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(e){var o="";e=e||{},"string"==typeof e?(o=e,e={}):"object"==typeof e&&(o=""),this.name=o,this.id=t.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}return t.idCounter=0,t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return r});var i=o(14),n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=function(t){function e(){return t.call(this)||this}return n(e,t),e.prototype.collisionPairs=function(t,e,o){var i,n,r,s,a=t.bodies,u=a.length;for(i=0;i!==u;i++)for(n=0;n!==i;n++)r=a[i],s=a[n],this.needBroadphaseCollision(r,s)&&this.intersectionTest(r,s,e,o)},e.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=0;i<t.bodies.length;i++){var n=t.bodies[i];n.aabbNeedsUpdate&&n.computeAABB(),n.aabb.overlaps(e)&&o.push(n)}return o},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return u});var i=o(0),n=o(10),r=o(2),s=o(1),a=o(4),u=function(){function t(e,o){this.tmpAABB=new a.a,this.tmpArray=[],this.v1=new i.a,this.v2=new i.a,this.intersectBody_xi=new i.a,this.intersectBody_qi=new r.a,this.vector=new i.a,this.normal=new i.a,this.intersectPoint=new i.a,this.a=new i.a,this.b=new i.a,this.c=new i.a,this.d=new i.a,this.tmpRaycastResult=new n.a,this.Ray_intersectSphere_intersectionPoint=new i.a,this.Ray_intersectSphere_normal=new i.a,this.intersectConvex_normal=new i.a,this.intersectConvex_minDistNormal=new i.a,this.intersectConvex_minDistIntersect=new i.a,this.intersectConvex_vector=new i.a,this.v0=new i.a,this.intersect=new i.a,this.from=e?e.clone():new i.a,this.to=o?o.clone():new i.a,this._direction=new i.a,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=t.ANY,this.result=new n.a,this.hasHit=!1,this.callback=function(t){}}return t.prototype.intersectWorld=function(e,o){return this.mode=o.mode||t.ANY,this.result=o.result||new n.a,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=void 0!==o.collisionFilterMask?o.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==o.collisionFilterGroup?o.collisionFilterGroup:-1,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(this.tmpAABB),this.tmpArray.length=0,e.broadphase.aabbQuery(e,this.tmpAABB,this.tmpArray),this.intersectBodies(this.tmpArray),this.hasHit},t.pointInTriangle=function(t,e,o,n){var r=new i.a,s=new i.a,a=new i.a;n.vsub(e,r),o.vsub(e,s),t.vsub(e,a);var u,h,l=r.dot(r),p=r.dot(s),c=r.dot(a),d=s.dot(s),v=s.dot(a);return(u=d*c-p*v)>=0&&(h=l*v-p*c)>=0&&u+h<l*d-p*p},t.prototype.intersectBody=function(t,e){e&&(this.result=e,this.updateDirection());var o=this.checkCollisionResponse;if((!o||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=this.intersectBody_xi,n=this.intersectBody_qi,r=0,s=t.shapes.length;r<s;r++){var a=t.shapes[r];if((!o||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[r],n),t.quaternion.vmult(t.shapeOffsets[r],i),i.vadd(t.position,i),this.intersectShape(a,n,i,t),this.result._shouldStop))break}},t.prototype.intersectBodies=function(t,e){e&&(this.result=e,this.updateDirection());for(var o=0,i=t.length;!this.result._shouldStop&&o<i;o++)this.intersectBody(t[o])},t.prototype.updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},t.prototype.intersectShape=function(t,e,o,i){var n=this.from;if(!(this.distanceFromIntersection(n,this._direction,o)>t.boundingSphereRadius))switch(t.type){case s.a.types.CONVEXPOLYHEDRON:this.intersectConvex(t,e,o,i,t);break;case s.a.types.BOX:this.intersectBox(t,e,o,i,t);break;case s.a.types.SPHERE:this.intersectSphere(t,e,o,i,t)}},t.prototype.intersectBox=function(t,e,o,i,n){return this.intersectConvex(t.convexPolyhedronRepresentation,e,o,i,n)},t.prototype.intersectPlane=function(t,e,o,n,r){var s=this.from,a=this.to,u=this._direction,h=new i.a(0,0,1);e.vmult(h,h);var l=new i.a;s.vsub(o,l);var p=l.dot(h);if(a.vsub(o,l),!(p*l.dot(h)>0||s.distanceTo(a)<p)){var c=h.dot(u);if(!(Math.abs(c)<this.precision)){var d=new i.a,v=new i.a,f=new i.a;s.vsub(o,d);var y=-h.dot(d)/c;u.scale(y,v),s.vadd(v,f),this.reportIntersection(h,f,r,n,-1)}}},t.prototype.getAABB=function(t){var e=this.to,o=this.from;t.lowerBound.x=Math.min(e.x,o.x),t.lowerBound.y=Math.min(e.y,o.y),t.lowerBound.z=Math.min(e.z,o.z),t.upperBound.x=Math.max(e.x,o.x),t.upperBound.y=Math.max(e.y,o.y),t.upperBound.z=Math.max(e.z,o.z)},t.prototype.intersectSphere=function(t,e,o,i,n){var r=this.from,s=this.to,a=t.radius,u=Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2)+Math.pow(s.z-r.z,2),h=2*((s.x-r.x)*(r.x-o.x)+(s.y-r.y)*(r.y-o.y)+(s.z-r.z)*(r.z-o.z)),l=Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)+Math.pow(r.z-o.z,2)-Math.pow(a,2),p=Math.pow(h,2)-4*u*l,c=this.Ray_intersectSphere_intersectionPoint,d=this.Ray_intersectSphere_normal;if(!(p<0))if(0===p)r.lerp(s,p,c),c.vsub(o,d),d.normalize(),this.reportIntersection(d,c,n,i,-1);else{var v=(-h-Math.sqrt(p))/(2*u),f=(-h+Math.sqrt(p))/(2*u);if(v>=0&&v<=1&&(r.lerp(s,v,c),c.vsub(o,d),d.normalize(),this.reportIntersection(d,c,n,i,-1)),this.result._shouldStop)return;f>=0&&f<=1&&(r.lerp(s,f,c),c.vsub(o,d),d.normalize(),this.reportIntersection(d,c,n,i,-1))}},t.prototype.intersectConvex=function(e,o,i,n,r,s){for(var a=(this.intersectConvex_minDistNormal,this.intersectConvex_normal),u=this.intersectConvex_vector,h=(this.intersectConvex_minDistIntersect,s&&s.faceList||null),l=e.faces,p=e.vertices,c=e.faceNormals,d=this._direction,v=this.from,f=this.to,y=v.distanceTo(f),m=h?h.length:l.length,w=this.result,_=0;!w._shouldStop&&_<m;_++){var x=h?h[_]:_,b=l[x],g=c[x],E=o,B=i;u.copy(p[b[0]]),E.vmult(u,u),u.vadd(B,u),u.vsub(v,u),E.vmult(g,a);var P=d.dot(a);if(!(Math.abs(P)<this.precision)){var z=a.dot(u)/P;if(!(z<0)){d.mult(z,this.intersectPoint),this.intersectPoint.vadd(v,this.intersectPoint),this.a.copy(p[b[0]]),E.vmult(this.a,this.a),B.vadd(this.a,this.a);for(var C=1;!w._shouldStop&&C<b.length-1;C++){this.b.copy(p[b[C]]),this.c.copy(p[b[C+1]]),E.vmult(this.b,this.b),E.vmult(this.c,this.c),B.vadd(this.b,this.b),B.vadd(this.c,this.c);var A=this.intersectPoint.distanceTo(v);!t.pointInTriangle(this.intersectPoint,this.a,this.b,this.c)&&!t.pointInTriangle(this.intersectPoint,this.b,this.a,this.c)||A>y||this.reportIntersection(a,this.intersectPoint,r,n,x)}}}}},t.prototype.reportIntersection=function(e,o,i,n,r){var s=this.from,a=this.to,u=s.distanceTo(o),h=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(h.hitFaceIndex=void 0!==r?r:-1,this.mode){case t.ALL:this.hasHit=!0,h.set(s,a,e,o,i,n,u),h.hasHit=!0,this.callback(h);break;case t.CLOSEST:(u<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,o,i,n,u));break;case t.ANY:this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,o,i,n,u),h._shouldStop=!0}},t.prototype.distanceFromIntersection=function(t,e,o){o.vsub(t,this.v0);var i=this.v0.dot(e);return e.mult(i,this.intersect),this.intersect.vadd(t,this.intersect),o.distanceTo(this.intersect)},t.CLOSEST=1,t.ANY=2,t.ALL=4,t}()},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(4);o.d(e,"AABB",function(){return i.a});var n=o(11);o.d(e,"ArrayCollisionMatrix",function(){return n.a});var r=o(3);o.d(e,"BodyOptions",function(){return r.b}),o.d(e,"Body",function(){return r.a});var s=o(12);o.d(e,"Box",function(){return s.a});var a=o(14);o.d(e,"Broadphase",function(){return a.a});var u=o(28);o.d(e,"Constraint",function(){return u.a});var h=o(8);o.d(e,"ContactEquation",function(){return h.a});var l=o(18);o.d(e,"Narrowphase",function(){return l.a});var p=o(22);o.d(e,"ContactMaterial",function(){return p.a});var c=o(7);o.d(e,"HullResult",function(){return c.b}),o.d(e,"ConvexPolyhedron",function(){return c.a});var d=o(29);o.d(e,"Cylinder",function(){return d.a});var v=o(16);o.d(e,"Equation",function(){return v.a});var f=o(6);o.d(e,"EventTarget",function(){return f.a});var y=o(21);o.d(e,"FrictionEquation",function(){return y.a});var m=o(23);o.d(e,"GSSolver",function(){return m.a});var w=o(5);o.d(e,"Mat3",function(){return w.a});var _=o(24);o.d(e,"Material",function(){return _.a});var x=o(25);o.d(e,"NaiveBroadphase",function(){return x.a});var b=o(20);o.d(e,"Pool",function(){return b.a});var g=o(30);o.d(e,"Particle",function(){return g.a});var E=o(31);o.d(e,"Plane",function(){return E.a});var B=o(2);o.d(e,"Quaternion",function(){return B.a});var P=o(26);o.d(e,"Ray",function(){return P.a});var z=o(10);o.d(e,"RaycastResult",function(){return z.a});var C=o(1);o.d(e,"Shape",function(){return C.a});var A=o(9);o.d(e,"Solver",function(){return A.a});var S=o(32);o.d(e,"Sphere",function(){return S.a});var M=o(33);o.d(e,"SplitNode",function(){return M.a}),o.d(e,"SplitSolver",function(){return M.b});var q=o(13);o.d(e,"Transform",function(){return q.a});var N=o(0);o.d(e,"Vec3",function(){return N.a}),o.d(e,"Vec3Consts",function(){return N.b});var j=o(19);o.d(e,"Vec3Pool",function(){return j.a});var F=o(34);o.d(e,"ContactEvent",function(){return F.b}),o.d(e,"ShapeContactEvent",function(){return F.c}),o.d(e,"CollideEvent",function(){return F.a}),o.d(e,"World",function(){return F.d});var I=o(17);o.d(e,"JacobianElement",function(){return I.a})},function(t,e,o){"use strict";o.d(e,"a",function(){return n});var i=o(15),n=function(){function t(e,o,n){n=i.a.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=o,this.id=t.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),o&&o.wakeUp())}return t.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},t.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},t.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},t.idCounter=0,t}()},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(7),n=o(0),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(e,o,i,r){var s=r,a=[],u=[],h=[],l=[],p=[],c=Math.cos,d=Math.sin;a.push(new n.a(o*c(0),o*d(0),.5*-i)),l.push(0),a.push(new n.a(e*c(0),e*d(0),.5*i)),p.push(1);for(var v=0;v<s;v++){var f=2*Math.PI/s*(v+1),y=2*Math.PI/s*(v+.5);v<s-1?(a.push(new n.a(o*c(f),o*d(f),.5*-i)),l.push(2*v+2),a.push(new n.a(e*c(f),e*d(f),.5*i)),p.push(2*v+3),h.push([2*v+2,2*v+3,2*v+1,2*v])):h.push([0,1,2*v+1,2*v]),(s%2==1||v<s/2)&&u.push(new n.a(c(y),d(y),0))}h.push(p),u.push(new n.a(0,0,1));for(var m=[],v=0;v<l.length;v++)m.push(l[l.length-v-1]);return h.push(m),t.call(this,a,h,u)||this}return r(e,t),e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(1),n=o(0),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(){return t.call(this,{type:i.a.types.PARTICLE})||this}return r(e,t),e.prototype.calculateLocalInertia=function(t,e){return e=e||new n.a,e.set(0,0,0),e},e.prototype.volume=function(){return 0},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},e.prototype.calculateWorldAABB=function(t,e,o,i){o.copy(t),i.copy(t)},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(1),n=o(0),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(){var e=t.call(this,{type:i.a.types.PLANE})||this;return e.tempNormal=new n.a,e.worldNormal=new n.a,e.worldNormalNeedsUpdate=!0,e.boundingSphereRadius=Number.MAX_VALUE,e}return r(e,t),e.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},e.prototype.calculateLocalInertia=function(t,e){return e=e||new n.a},e.prototype.volume=function(){return Number.MAX_VALUE},e.prototype.calculateWorldAABB=function(t,e,o,i){this.tempNormal.set(0,0,1),e.vmult(this.tempNormal,this.tempNormal);var n=Number.MAX_VALUE;o.set(-n,-n,-n),i.set(n,n,n),1===this.tempNormal.x&&(i.x=t.x),1===this.tempNormal.y&&(i.y=t.y),1===this.tempNormal.z&&(i.z=t.z),-1===this.tempNormal.x&&(o.x=t.x),-1===this.tempNormal.y&&(o.y=t.y),-1===this.tempNormal.z&&(o.z=t.z)},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return s});var i=o(1),n=o(0),r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),s=function(t){function e(e){var o=t.call(this,{type:i.a.types.SPHERE})||this;if(o.radius=void 0!==e?e:1,o.radius<0)throw new Error("The sphere radius cannot be negative.");return o.updateBoundingSphereRadius(),o}return r(e,t),e.prototype.calculateLocalInertia=function(t,e){e=e||new n.a;var o=2*t*this.radius*this.radius/5;return e.x=o,e.y=o,e.z=o,e},e.prototype.volume=function(){return 4*Math.PI*this.radius/3},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},e.prototype.calculateWorldAABB=function(t,e,o,i){var n=this.radius;o.x=t.x-n,i.x=t.x+n,o.y=t.y-n,i.y=t.y+n,o.z=t.z-n,i.z=t.z+n},e}(i.a)},function(t,e,o){"use strict";function i(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!(i.visited||i.body.type&p.STATIC))return i}}function n(t,e,o,n){for(c.push(t),t.visited=!0,e(t,o,n);c.length;)for(var r=c.pop(),s=void 0;s=i(r.children);)s.visited=!0,e(s,o,n),c.push(s)}function r(t,e,o){e.push(t.body);for(var i=t.eqs.length,n=0;n!==i;n++){var r=t.eqs[n];-1===o.indexOf(r)&&o.push(r)}}function s(t,e){return e.id-t.id}o.d(e,"a",function(){return l}),o.d(e,"b",function(){return p});var a=o(9),u=o(3),h=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),l=function(){function t(){}return t}(),p=function(t){function e(e){var o=t.call(this)||this;for(o.SplitSolver_solve_nodes=[],o.SplitSolver_solve_nodePool=[],o.SplitSolver_solve_eqs=[],o.SplitSolver_solve_dummyWorld={bodies:[]},o.iterations=10,o.tolerance=1e-7,o.subsolver=e,o.nodes=[],o.nodePool=[];o.nodePool.length<128;)o.nodePool.push(o.createNode());return o}return h(e,t),e.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},e.prototype.solve=function(t,e){for(var o=this.SplitSolver_solve_nodes,a=this.nodePool,u=e.bodies,h=this.equations,l=h.length,p=u.length,c=this.subsolver;a.length<p;)a.push(this.createNode());o.length=p;for(var d=0;d<p;d++)o[d]=a[d];for(var d=0;d!==p;d++){var v=o[d];v.body=u[d],v.children.length=0,v.eqs.length=0,v.visited=!1}for(var f=0;f!==l;f++){var y=h[f],m=u.indexOf(y.bi),w=u.indexOf(y.bj),_=o[m],x=o[w];_.children.push(x),_.eqs.push(y),x.children.push(_),x.eqs.push(y)}var b,g=0,E=this.SplitSolver_solve_eqs;c.tolerance=this.tolerance,c.iterations=this.iterations;for(var B=this.SplitSolver_solve_dummyWorld;b=i(o);){E.length=0,B.bodies.length=0,n(b,r,B.bodies,E);var P=E.length;E=E.sort(s);for(var d=0;d!==P;d++)c.addEquation(E[d]);c.solve(t,B),c.removeAllEquations(),g++}return g},e.STATIC=u.a.STATIC,e}(a.a),c=[]},function(t,e,o){"use strict";o.d(e,"b",function(){return _}),o.d(e,"c",function(){return x}),o.d(e,"a",function(){return b}),o.d(e,"d",function(){return g});var i=o(6),n=o(0),r=o(2),s=o(24),a=o(22),u=o(4),h=o(26),l=o(35),p=o(3),c=o(10),d=o(23),v=o(18),f=o(36),y=o(11),m=o(25),w=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),_=function(){function t(){}return t}(),x=function(){function t(){}return t}(),b=function(){function t(){}return t}(),g=function(t){function e(e){var o=t.call(this)||this;return o.tmpAABB1=new u.a,o.tmpArray1=[],o.tmpRay=new h.a,o.removeBody=function(t){return o.remove(t)},o.World_step_postStepEvent={type:"postStep"},o.World_step_preStepEvent={type:"preStep"},o.World_step_collideEvent={type:p.a.COLLIDE_EVENT_NAME,body:null,contact:null},o.World_step_oldContacts=[],o.World_step_frictionEquationPool=[],o.World_step_p1=[],o.World_step_p2=[],o.World_step_gvec=new n.a,o.World_step_vi=new n.a,o.World_step_vj=new n.a,o.World_step_wi=new n.a,o.World_step_wj=new n.a,o.World_step_t1=new n.a,o.World_step_t2=new n.a,o.World_step_rixn=new n.a,o.World_step_rjxn=new n.a,o.World_step_step_q=new r.a,o.World_step_step_w=new r.a,o.World_step_step_wq=new r.a,o.invI_tau_dt=new n.a,o.emitContactEvents=function(){var t=[],e=[],i={type:"beginContact",bodyA:null,bodyB:null},n={type:"endContact",bodyA:null,bodyB:null},r={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},s={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){var a=o.hasAnyEventListener("beginContact"),u=o.hasAnyEventListener("endContact");if((a||u)&&o.bodyOverlapKeeper.getDiff(t,e),a)for(var h=0,l=t.length;h<l;h+=2)i.bodyA=o.getBodyById(t[h]),i.bodyB=o.getBodyById(t[h+1]),i.bodyA&&i.bodyB&&o.dispatchEvent(i),i.bodyA=i.bodyB=void 0;if(u)for(var h=0,l=e.length;h<l;h+=2)n.bodyA=o.getBodyById(e[h]),n.bodyB=o.getBodyById(e[h+1]),n.bodyA&&n.bodyB&&o.dispatchEvent(n),n.bodyA=n.bodyB=void 0;t.length=e.length=0;var p=o.hasAnyEventListener("beginShapeContact"),c=o.hasAnyEventListener("endShapeContact");if((p||c)&&o.shapeOverlapKeeper.getDiff(t,e),p)for(var h=0,l=t.length;h<l;h+=2){var d=o.getShapeById(t[h]),v=o.getShapeById(t[h+1]);r.shapeA=d,r.shapeB=v,r.bodyA=d.body,r.bodyB=v.body,o.dispatchEvent(r),r.shapeA=r.shapeB=void 0,r.bodyA=r.bodyB=void 0}if(c)for(var h=0,l=e.length;h<l;h+=2){var d=o.getShapeById(e[h]),v=o.getShapeById(e[h+1]);s.shapeA=d,s.shapeB=v,s.bodyA=d.body,s.bodyB=v.body,o.dispatchEvent(s),s.shapeA=s.shapeB=void 0,s.bodyA=s.bodyB=void 0}}},e=e||{},o.dt=-1,o.allowSleep=!!e.allowSleep,o.contacts=[],o.frictionEquations=[],o.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,o.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,o.time=0,o.stepnumber=0,o.default_dt=1/60,o.nextId=0,o.gravity=new n.a,e.gravity&&o.gravity.copy(e.gravity),o.broadphase=void 0!==e.broadphase?e.broadphase:new m.a,o.bodies=[],o.solver=void 0!==e.solver?e.solver:new d.a,o.constraints=[],o.narrowphase=new v.a(o),o.collisionMatrix=new y.a,o.collisionMatrixPrevious=new y.a,o.bodyOverlapKeeper=new f.a,o.shapeOverlapKeeper=new f.a,o.materials=[],o.contactmaterials=[],o.contactMaterialTable=new l.a,o.defaultMaterial=new s.a("default"),o.defaultContactMaterial=new a.a(o.defaultMaterial,o.defaultMaterial,{friction:1,restitution:0}),o.doProfiling=!1,o.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},o.accumulator=0,o.subsystems=[],o.addBodyEvent={type:"addBody",body:null},o.removeBodyEvent={type:"removeBody",body:null},o.idToBodyMap={},o.broadphase.setWorld(o),o}return w(e,t),e.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},e.prototype.numObjects=function(){return this.bodies.length},e.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},e.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof p.a&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))},e.prototype.addConstraint=function(t){this.constraints.push(t)},e.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},e.prototype.rayTest=function(t,e,o){o instanceof c.a?this.raycastClosest(t,e,{skipBackfaces:!0},o):this.raycastAll(t,e,{skipBackfaces:!0},o)},e.prototype.raycastAll=function(t,e,o,i){return o.mode=h.a.ALL,o.from=t,o.to=e,o.callback=i,this.tmpRay.intersectWorld(this,o)},e.prototype.raycastAny=function(t,e,o,i){return o.mode=h.a.ANY,o.from=t,o.to=e,o.result=i,this.tmpRay.intersectWorld(this,o)},e.prototype.raycastClosest=function(t,e,o,i){return o.mode=h.a.CLOSEST,o.from=t,o.to=e,o.result=i,this.tmpRay.intersectWorld(this,o)},e.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,o=this.bodies,i=o.indexOf(t);if(-1!==i){o.splice(i,1);for(var n=0;n!==o.length;n++)o[n].index=n;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}},e.prototype.getBodyById=function(t){return this.idToBodyMap[t]},e.prototype.getShapeById=function(t){for(var e=this.bodies,o=0,i=e.length;o<i;o++)for(var n=e[o].shapes,r=0,s=n.length;r<s;r++){var a=n[r];if(a.id===t)return a}},e.prototype.addMaterial=function(t){this.materials.push(t)},e.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},e.prototype.step=function(t,e,o){if(o=o||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&i<o;)this.internalStep(t),this.accumulator-=t,i++;for(var n=this.accumulator%t/t,r=this.bodies.length,s=0;s!==r;s++){var a=this.bodies[s];a.previousPosition.lerp(a.position,n,a.interpolatedPosition),a.previousQuaternion.slerp(a.quaternion,n,a.interpolatedQuaternion),a.previousQuaternion.normalize()}this.time+=e}},e.prototype.internalStep=function(t){this.dt=t;var e,o=this.contacts,i=this.World_step_p1,n=this.World_step_p2,r=this.numObjects(),s=this.bodies,a=this.solver,u=this.gravity,h=this.doProfiling,l=this.profile,c=p.a.DYNAMIC,d=this.constraints,v=this.World_step_frictionEquationPool,f=(u.norm(),u.x),y=u.y,m=u.z,w=0;for(h&&(e=performance.now()),w=0;w!==r;w++){var _=s[w];if(_.type===c){var x=_.force,b=_.mass;x.x+=b*f,x.y+=b*y,x.z+=b*m}}var g;for(w=0,g=this.subsystems.length;w!==g;w++)this.subsystems[w].update();h&&(e=performance.now()),i.length=0,n.length=0,this.broadphase.collisionPairs(this,i,n),h&&(l.broadphase=performance.now()-e);var E=d.length;for(w=0;w!==E;w++){var B=d[w];if(!B.collideConnected)for(var P=i.length-1;P>=0;P-=1)(B.bodyA===i[P]&&B.bodyB===n[P]||B.bodyB===i[P]&&B.bodyA===n[P])&&(i.splice(P,1),n.splice(P,1))}this.collisionMatrixTick(),h&&(e=performance.now());var z=this.World_step_oldContacts,C=o.length;for(w=0;w!==C;w++)z.push(o[w]);o.length=0;var A=this.frictionEquations.length;for(w=0;w!==A;w++)v.push(this.frictionEquations[w]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,n,this,o,z,this.frictionEquations,v),h&&(l.narrowphase=performance.now()-e),h&&(e=performance.now()),w=0;w<this.frictionEquations.length;w++)a.addEquation(this.frictionEquations[w]);for(var S=o.length,M=0;M!==S;M++){var B=o[M],_=B.bi,q=B.bj,N=B.si,j=B.sj,F=void 0;F=_.material&&q.material?this.getContactMaterial(_.material,q.material)||this.defaultContactMaterial:this.defaultContactMaterial,F.friction,_.material&&q.material&&(_.material.friction>=0&&q.material.friction>=0&&(_.material.friction,q.material.friction),_.material.restitution>=0&&q.material.restitution>=0&&(B.restitution=_.material.restitution*q.material.restitution)),a.addEquation(B),_.allowSleep&&_.type===p.a.DYNAMIC&&_.sleepState===p.a.SLEEPING&&q.sleepState===p.a.AWAKE&&q.type!==p.a.STATIC&&q.velocity.norm2()+q.angularVelocity.norm2()>=2*Math.pow(q.sleepSpeedLimit,2)&&(_._wakeUpAfterNarrowphase=!0),q.allowSleep&&q.type===p.a.DYNAMIC&&q.sleepState===p.a.SLEEPING&&_.sleepState===p.a.AWAKE&&_.type!==p.a.STATIC&&_.velocity.norm2()+_.angularVelocity.norm2()>=2*Math.pow(_.sleepSpeedLimit,2)&&(q._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(_,q,!0),this.collisionMatrixPrevious.get(_,q)||(this.World_step_collideEvent.body=q,this.World_step_collideEvent.contact=B,_.dispatchEvent(this.World_step_collideEvent),this.World_step_collideEvent.body=_,q.dispatchEvent(this.World_step_collideEvent)),this.bodyOverlapKeeper.set(_.id,q.id),this.shapeOverlapKeeper.set(N.id,j.id)}for(this.emitContactEvents(),h&&(l.makeContactConstraints=performance.now()-e,e=performance.now()),w=0;w!==r;w++){var _=s[w];_._wakeUpAfterNarrowphase&&(_.wakeUp(),_._wakeUpAfterNarrowphase=!1)}var I=d.length;for(w=0;w!==I;w++){var B=d[w];B.update();for(var P=0,R=B.equations.length;P!==R;P++){var O=B.equations[P];a.addEquation(O)}}a.solve(t,this),h&&(l.solve=performance.now()-e),a.removeAllEquations();var T=Math.pow;for(w=0;w!==r;w++){var _=s[w];if(_.type&c){var W=T(1-_.linearDamping,t),L=_.velocity;L.mult(W,L);var k=_.angularVelocity;if(k){var V=T(1-_.angularDamping,t);k.mult(V,k)}}}for(this.dispatchEvent(this.World_step_preStepEvent),w=0;w!==r;w++){var _=s[w];_.preStep&&_.preStep.call(_)}h&&(e=performance.now());var U=this.stepnumber,G=U%(this.quatNormalizeSkip+1)==0,D=this.quatNormalizeFast;for(w=0;w!==r;w++)s[w].integrate(t,G,D);for(this.clearForces(),this.broadphase.dirty=!0,h&&(l.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(this.World_step_postStepEvent),w=0;w!==r;w++){var _=s[w],X=_.postStep;X&&X.call(_)}if(this.allowSleep)for(w=0;w!==r;w++)s[w].sleepTick(this.time)},e.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,o=0;o!==e;o++){var i=t[o];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}},e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",function(){return i});var i=function(){function t(){this.data={keys:[]}}return t.prototype.get=function(t,e){if(t>e){var o=e;e=t,t=o}return this.data[t+"-"+e]},t.prototype.set=function(t,e,o){if(t>e){var i=e;e=t,t=i}var n=t+"-"+e;this.get(t,e)||this.data.keys.push(n),this.data[n]=o},t.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;)delete t[e.pop()]},t}()},function(t,e,o){"use strict";function i(t,e){t.push((4294901760&e)>>16,65535&e)}o.d(e,"a",function(){return n});var n=function(){function t(){this.current=[],this.previous=[]}return t.prototype.getKey=function(t,e){if(e<t){var o=e;e=t,t=o}return t<<16|e},t.prototype.set=function(t,e){for(var o=this.getKey(t,e),i=this.current,n=0;o>i[n];)n++;if(o!==i[n]){for(var r=i.length-1;r>=n;r--)i[r+1]=i[r];i[n]=o}},t.prototype.tick=function(){var t=this.current;this.current=this.previous,this.previous=t,this.current.length=0},t.prototype.getDiff=function(t,e){for(var o=this.current,n=this.previous,r=o.length,s=n.length,a=0,u=0;u<r;u++){for(var h=o[u];h>n[a];)a++;h===n[a]||i(t,h)}a=0;for(var u=0;u<s;u++){for(var l=n[u];l>o[a];)a++;o[a]===l||i(e,l)}},t}()}])});